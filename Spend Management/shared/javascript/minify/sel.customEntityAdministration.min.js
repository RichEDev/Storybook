(function(n,t,i,r,u,f,e,o,s,h,c,l){function a(){n.registerNamespace("SEL.CustomEntityAdministration");n.CustomEntityAdministration={IDs:{Entity:-1,Attribute:-1,Form:-1,View:-1,Sort:{Column:null,Direction:null},DateFormat:"dd/mm/yy",Relationship:{RelationshipType:null,RelatedTable:null,SelectedDisplayField:null,SelectedMatchFields:null,SelectedRelationshipEntity:null,SelectedViewID:null}},DomIDs:{Base:{FormSelectionAttribute:null},Attributes:{Grid:null,Summary:{Modal:{Control:null,Panel:null,PanelHeader:null,TabContainer:null,General:{Tab:null,Name:null,Description:null,SummarySource:null},Relationships:{Tab:null,Control:null},Columns:{Tab:null,Control:null},DisplayFieldModal:{Control:null,Panel:null,Tree:null}}},Relationship:{NtoOne:{Modal:{Control:null,Panel:null,PanelHeader:null,TabContainer:null,General:{Tab:null,RelationshipName:null,RelationshipNameReqValidator:null,Description:null,Mandatory:null,MandatoryLabel:null,RelationshipEntity:null,RelationshipEntityReqValidator:null,Tooltip:null,RelationshipView:null,RelationshipViewReqValidator:null},Fields:{Tab:null,DisplayField:null,DisplayFieldReqValidator:null,MatchFields:null,MatchFieldsReqValidator:null,MaxRows:null,MaxRowsCmpValidator:null,MatchFieldSelector:{FieldItems:null,Modal:{Control:null,Panel:null}}},Filters:{Tab:null,TreeContainer:null,Tree:null,Drop:null},LookupDisplayFields:{Tab:null,TreeContainer:null,Tree:null,Drop:null}}},OnetoN:{Modal:{Control:null,Panel:null,PanelHeader:null,TabContainer:null,General:{Tab:null,RelationshipName:null,RelationshipNameReqValidator:null,Description:null,Mandatory:null,MandatoryLabel:null,RelationshipEntity:null,RelationshipEntityReqValidator:null,Tooltip:null,RelationshipView:null,RelationshipViewReqValidator:null}}}}},Forms:{RichTextEditor:null,EditorExtender:null},Views:{Grid:null,Modal:{Control:null,Panel:null,PanelHeader:null,TabContainer:null,General:{Tab:null,Name:null,Description:null,Menu:null,MenuDescription:null,AddForm:null,AddFormSelectionMappings:null,EditForm:null,EditFormSelectionMappings:null,AllowDelete:null,AllowApproval:null,FormSelectionMappings:{Panel:null,Modal:null,Header:null,Body:null}},Fields:{Tab:null,TreeContainer:null,Tree:null,Drop:null},Filters:{Tab:null,TreeContainer:null,Panel:null},Sort:{Tab:null,Column:null,Direction:null,OrderValidator:null},Icon:{SearchName:null}}}},zIndices:{Base:{},Attributes:{Relationship:{Modal:1e4}},Forms:{Modal:1e4,Tabs:function(){return n.CustomEntityAdministration.zIndices.Forms.Modal+5},Sections:function(){return n.CustomEntityAdministration.zIndices.Forms.Modal+10},Fields:function(){return n.CustomEntityAdministration.zIndices.Forms.Modal+15},ContextMenu:function(){return n.CustomEntityAdministration.zIndices.Forms.Modal+20},AvailableFieldsModal:function(){return n.CustomEntityAdministration.zIndices.Forms.Modal+25},AvailableFields:function(){return n.CustomEntityAdministration.zIndices.Forms.Modal+30}},Views:{Modal:1e4,TreeNodes:function(){return n.CustomEntityAdministration.zIndices.Views.Modal+5},HelpIcon:function(){return n.CustomEntityAdministration.zIndices.Views.Modal+10},ListItemInformation:function(){return n.CustomEntityAdministration.zIndices.Views.Modal+15},ViewFilterHelpIcon:function(){return n.CustomEntityAdministration.zIndices.Views.Modal+20}},Misc:{InformationMessage:function(){return n.CustomEntityAdministration.zIndices.Views.Modal+25}}},Messages:{ModalTitle:"Message from "+l,NoneOption:"[None]",Base:{},Attributes:{Relationship:{DuplicateName:"An attribute or relationship with this Display name already exists.",RecursionWarning:"This relationship cannot be saved as it would create a loop in the relationships.",SelectRemovalItem:"Please select a lookup field in the list to remove.",NoRemovalItems:"There are no lookup fields in the list to remove."}},Forms:{},Views:{DuplicateName:"The View name you have entered already exists.",DeleteSure:"Are you sure you wish to delete the selected view?",DeleteAbortInUse:"This view cannot be deleted as it is currently in use within a relationship.",DeleteAbortPopupViewInUse:"This view cannot be deleted as it is currently in use within a Pop-up window view."}},Misc:{LoadingScreenCancelled:!1,ShowInformationMessage:function(i){if(n.CustomEntityAdministration.Misc.LoadingScreenCancelled===!1&&t("#loadingArea").length===0){var r=t('<span id="loadingArea">'+i+"<\/span>");r.css("zIndex",n.CustomEntityAdministration.zIndices.Misc.InformationMessage());r.css("left",t(window).width()/2-75).css("top",t(window).height()/2-90);t("#divPages").append(r)}},SetupEnterKeyBindings:function(){var t=n.CustomEntityAdministration;n.Common.BindEnterKeyForSelector(".primaryPage .formpanel .inputs INPUT",t.Base.Save);n.Common.BindEnterKeyForSelector("#"+txtattributenameid,saveAttribute,"#"+txtlistitemid);n.Common.BindEnterKeyForSelector("#"+chkattributemandatoryid,saveAttribute,"#"+txtlistitemid);n.Common.BindEnterKeyForSelector("#"+txtmaxlengthid,saveAttribute,"#"+txtlistitemid);n.Common.BindEnterKeyForSelector("#"+cmbdefaultvalueid,saveAttribute,"#"+txtlistitemid);n.Common.BindEnterKeyForSelector("#"+cmbtextformatid,saveAttribute,"#"+txtlistitemid);n.Common.BindEnterKeyForSelector("#"+lstitemsid,saveAttribute,"#"+txtlistitemid);n.Common.BindEnterKeyForSelector("#"+txtlistitemid,addListItem);n.Common.BindEnterKeyForSelector("#"+chkarchiveitemid,addListItem);n.Common.BindEnterKeyForSelector("#"+t.DomIDs.Attributes.Relationship.NtoOne.Modal.Panel+" .inputs .fillspan",t.Attributes.Relationship.ManyToOne.Save);n.Common.BindEnterKeyForSelector("#"+t.DomIDs.Attributes.Relationship.OnetoN.Modal.Panel+" .inputs .fillspan",t.Attributes.Relationship.OneToMany.Save);n.Common.BindEnterKeyForSelector("#"+t.DomIDs.Attributes.Summary.Modal.General.Name,t.Attributes.Summary.saveSummary);n.Common.BindEnterKeyForSelector("#"+tabConFormsID+" .inputs INPUT",t.Forms.SaveForm);n.Common.BindEnterKeyForSelector("#"+txttabid,t.Forms.SaveTabWithModalSave);n.Common.BindEnterKeyForSelector("#"+txtsectionid,t.Forms.SaveSectionWithModalSave);n.Common.BindEnterKeyForSelector("#"+txtfieldlabelID,t.Forms.UpdateFieldLabel);n.Common.BindEnterKeyForSelector("#txtDefaultText",t.Forms.UpdateDefaultText);n.Common.BindEnterKeyForSelector("#"+txtcopyformnameid,t.Forms.Copy);n.Common.BindEnterKeyForSelector("#"+t.DomIDs.Views.Modal.TabContainer+" .inputs INPUT",t.Views.SaveWithModalCheck);n.Common.BindEnterKeyForSelector("#"+t.DomIDs.Views.Modal.General.FormSelectionMappings.Panel+" INPUT",t.Views.General.FormSelectionMappings.Save)},ErrorHandler:function(i){n.CustomEntityAdministration.Misc.LoadingScreenCancelled=!0;t("#loadingArea").remove();n.Common.WebService.ErrorHandler(i)}},Base:{Save:function(){var u,o;if(i(chkEnableCurrenciesID).checked&&h(document.getElementById(cvDefaultCurrencyID),!0),validateform("vgMain")===!1)return!1;var l=document.getElementById(txtentitynameid).value,a=document.getElementById(txtpluralnameid).value,v=document.getElementById(txtdescriptionid).value,y=document.getElementById(chkenableattachmentsid).checked,it=document.getElementById(chkEnableAudiencesID).checked,p=t("#"+ddlAudienceBehaviourID).val(),w=document.getElementById(chkallowdocmergeid).checked,b=document.getElementById(chkEnableCurrenciesID).checked,k=document.getElementById(chkEnableLockingID).checked,e=document.getElementById(ddlDefaultCurrencyID),f=null;e!==null&&(f=e.options[e.selectedIndex].value,f==="0"&&(f=null));var d=document.getElementById(chkEnablePopupWindowID).checked,r=document.getElementById(ddlPopupWindowViewID),c=null;r!==null&&(c=r.options.length>0&&r.options[r.selectedIndex].value!=-1?r.options[r.selectedIndex].value:null);u=t("#"+n.CustomEntityAdministration.DomIDs.Base.FormSelectionAttribute);o=0;typeof u!="undefined"&&u!==null&&u.length>0&&(o=u.val());var g=+t("#ctl00_contentmain_Owner_SelectinatorText_ID").val()||null,nt=+t("#ctl00_contentmain_SupportContact_SelectinatorText_ID").val()||null,tt=t("#ctl00_contentmain_txtSupportQuestion").val();entityid===0&&(document.getElementById(hdnAuditAttributeID).value="0",document.getElementById(hdnAuditAttributeDisplayNameID).value="id");Spend_Management.svcCustomEntities.saveEntity(s.AccountID,employeeid,entityid,l,a,v,y,p,w,b,f,d,c,o,g,nt,tt,k,n.CustomEntityAdministration.Base.SaveEntityComplete)},SaveEntityComplete:function(t){if(t===-1){n.MasterPopup.ShowMasterPopup("The GreenLight name you have provided already exists.",n.CustomEntityAdministration.Messages.ModalTitle);return}if(t===-2){n.MasterPopup.ShowMasterPopup("The Plural name you have provided already exists.",n.CustomEntityAdministration.Messages.ModalTitle);return}if(t===-3){n.MasterPopup.ShowMasterPopup("The GreenLight name and Plural name you have provided already exist.",n.CustomEntityAdministration.Messages.ModalTitle);return}entityid=t;n.CustomEntityAdministration.IDs.Entity=t;setMonetaryState();switch(currentAction){case"addAttribute":currentAction="";showAttributeModal();break;case"addRelationship1":currentAction="";n.CustomEntityAdministration.Attributes.Relationship.ManyToOne.Modal.Show();break;case"addRelationship2":currentAction="";n.CustomEntityAdministration.Attributes.Relationship.OneToMany.Modal.Show();break;case"addSummary":currentAction="";n.CustomEntityAdministration.Attributes.Summary.Add();break;case"addForm":currentAction="";n.CustomEntityAdministration.Forms.NewForm();break;case"addView":currentAction="";n.CustomEntityAdministration.Views.Add();break;case"formSelectionAttributeChanged":currentAction="";break;default:document.location="custom_entities.aspx"}},AddShortCuts:function(t){n.CustomEntityAdministration.Base.RemoveAllShortCuts();switch(t){case"listAttribute":shortcut.add("Ctrl+1",function(){showListItemModal(!1)});shortcut.add("Ctrl+2",function(){removeListItem()});shortcut.add("Ctrl+3",function(){editListItem()});break;case"relationshipModal":shortcut.add("Ctrl+1",function(){n.CustomEntityAdministration.Attributes.Relationship.ManyToOne.FieldItem.Modal.Show(!1)});shortcut.add("Ctrl+2",function(){n.CustomEntityAdministration.Attributes.Relationship.ManyToOne.FieldItem.Remove()});break;case"formDesigner":shortcut.add("Ctrl+1",function(){n.CustomEntityAdministration.Forms.ShowTabModal(null,!0)});shortcut.add("Ctrl+2",function(){n.CustomEntityAdministration.Forms.ShowSectionModal(null,!0)});shortcut.add("Ctrl+3",function(){n.CustomEntityAdministration.Forms.ShortcutTabEdit()});shortcut.add("Ctrl+4",function(){n.CustomEntityAdministration.Forms.ToggleAvailableFields("expand")});shortcut.add("Ctrl+5",function(){n.CustomEntityAdministration.Forms.ToggleAvailableFields("dockleft")});shortcut.add("Ctrl+6",function(){n.CustomEntityAdministration.Forms.ToggleAvailableFields("dockright")})}},RemoveAllShortCuts:function(){shortcut.remove("Ctrl+1");shortcut.remove("Ctrl+2");shortcut.remove("Ctrl+3");shortcut.remove("Ctrl+4");shortcut.remove("Ctrl+5");shortcut.remove("Ctrl+6")},AssignDummyShortCuts:function(){n.CustomEntityAdministration.Base.RemoveAllShortCuts();shortcut.add("Ctrl+1",function(){});shortcut.add("Ctrl+2",function(){});shortcut.add("Ctrl+3",function(){});shortcut.add("Ctrl+4",function(){});shortcut.add("Ctrl+5",function(){});shortcut.add("Ctrl+6",function(){})},RefreshPopupViewDDL:function(n){var r=document.getElementById(ddlPopupWindowViewID),u=r.value,i,t;for(r.options.length=0,i=0;i<n.length;i++)t=document.createElement("OPTION"),t.text=n[i].Text,t.value=n[i].Value,t.value==u&&(t.selected=!0),r.options.add(t);return},AddFormSelectionAttribute:function(i,r){var f=n.CustomEntityAdministration.DomIDs.Base.FormSelectionAttribute,u=t("#"+f);typeof i=="undefined"||typeof r=="undefined"||i===null||r===null||isNaN(parseInt(r,10))||u===null||u.length!==1||u.find("option[value="+r+"]").length!==0||u.append('<option value="'+r+'">'+i+"<\/option>")},DeleteFormSelectionAttribute:function(i){var u=n.CustomEntityAdministration.DomIDs.Base.FormSelectionAttribute,r=t("#"+u);typeof i=="undefined"||i===null||isNaN(parseInt(i,10))||r===null||r.length!==1||r.find("option[value="+i+"]").length!==1||r.find("option[value="+i+"]").remove()},FormSelectionAttributeChanged:function(){entityid>0&&(currentAction="formSelectionAttributeChanged",n.CustomEntityAdministration.Base.Save())},SetAudienceListState:function(n){var i=t(".audienceBehaviour"),r=i.text();t(n).is(":checked")?(t("#"+ddlAudienceBehaviourID).prop("disabled",!1),t("#"+cmpAudienceID).prop("disabled",!1),h(t("#"+cmpAudienceID)[0],!0),i.addClass("mandatory"),i.text(r+"*")):(t("#"+ddlAudienceBehaviourID).prop("disabled",!0),t("#"+ddlAudienceBehaviourID).val(0),t("#"+cmpAudienceID).prop("disabled",!0),i.removeClass("mandatory"),r=r.replace("*",""),i.text(r),h(t("#"+cmpAudienceID)[0],!1))}},Attributes:{Summary:{lstSummarySrcChanged:!1,summaryEditData:null,availableRels:null,columnRels:null,Modal:{Hide:function(){currentAction="";n.Common.HideModal(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Control)},Show:function(){var u=n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Control;r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.TabContainer).set_activeTabIndex(0);n.CustomEntityAdministration.IDs.Attribute===0&&(currentAction="addSummary",i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.PanelHeader).innerHTML="New Summary Attribute");n.Common.ShowModal(u);t(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.Name).select()}},DisplayField:{currentDisplayFieldAttributeId:null,Modal:{Hide:function(){n.Common.HideModal(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.DisplayFieldModal.Control)},Show:function(){n.CustomEntityAdministration.Attributes.Summary.DisplayField.RefreshTree();n.Common.ShowModal(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.DisplayFieldModal.Control)}},RefreshTree:function(){Spend_Management.svcCustomEntities.GetInitialTreeNodesForDisplayField(n.CustomEntityAdministration.Attributes.Summary.DisplayField.currentDisplayFieldAttributeId,function(t){var i=n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.DisplayFieldModal.Tree;n.Trees.Tree.Clear(i);t!==null&&n.Trees.Tree.Data.Set(i,t)},n.CustomEntityAdministration.Misc.ErrorHandler)}},ClearSummaryForm:function(){n.Common.Page_ClientValidateReset();i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.Name).value="";i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.Description).value="";i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.SummarySource).selectedIndex=0;r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Tab).set_enabled(!1);r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Tab).set_enabled(!1)},GetSummarySources:function(){var t=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.SummarySource),u=0,f,e;t!==null&&(u=t[t.selectedIndex].value);t.selectedIndex!==0?(r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Tab).set_enabled(!0),r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Tab).set_enabled(!0)):(r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Tab).set_enabled(!1),r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Tab).set_enabled(!1));f=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Control);f!==null&&(f.innerHTML='<img src="/shared/images/ajax-loader.gif" alt="Loading..." />');e=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Control);e!==null&&(e.innerHTML='<img src="/shared/images/ajax-loader.gif" alt="Loading..." />');u!==0?Spend_Management.svcCustomEntities.getSummarySources(n.CustomEntityAdministration.IDs.Entity,u,n.CustomEntityAdministration.Attributes.Summary.onSourceSuccess,n.CustomEntityAdministration.Attributes.Summary.onSourceFail):(i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Control).innerHTML='<div class="onecolumnpanel">No current selections available.<\/div>',i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Control).innerHTML='<div class="onecolumnpanel">No current selections available.<\/div>')},onSourceSuccess:function(t){var r='<div class="onecolumnpanel">No current selections available.<\/div>',f=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Control),u;f.innerHTML=f!==null?t.length!=0?parseScript(t[0]):r:r;u=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Control);u.innerHTML=u!==null?t.length!==0?parseScript(t[1]):r:r;t.length!==0&&parseScript(t[2])},onSourceFail:function(t){n.MasterPopup.ShowMasterPopup("An error occurred attempting to retrieve the summary source information for the selected record\n"+t,n.CustomEntityAdministration.Messages.ModalTitle)},getSummary:function(){Spend_Management.svcCustomEntities.getRelationshipDropDown(entityid,n.CustomEntityAdministration.Forms.RelationshipType.OneToMany,!0,!1,n.CustomEntityAdministration.Attributes.Summary.getSummaryInfo,n.CustomEntityAdministration.Misc.ErrorHandler)},getSummaryInfo:function(t){n.CustomEntityAdministration.Attributes.Summary.updateSummarySourceDropdown(t);Spend_Management.svcCustomEntities.getSummary(s.AccountID,n.CustomEntityAdministration.IDs.Entity,n.CustomEntityAdministration.IDs.Attribute,n.CustomEntityAdministration.Attributes.Summary.onSummaryComplete,n.CustomEntityAdministration.Attributes.Summary.onSummaryFail)},onSummaryComplete:function(t){var u,f,e,o;if(n.CustomEntityAdministration.Attributes.Summary.ClearSummaryForm(),n.CustomEntityAdministration.Attributes.summaryEditData=t,i("divSummaryHeading").innerHTML="Summary Attribute: "+t[0],i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.Name).value=t[0],i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.Description).value=t[1],u=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.SummarySource),u!==null)for(f=0;f<u.options.length;f++)if(u[f].value===t[2]){u.selectedIndex=f;n.CustomEntityAdministration.Attributes.lstSummarySrcChanged=!0;e=i("divavailablerelationships");e!=null&&(e.innerHTML='<img src="/shared/images/ajax-loader.gif" alt="Loading..." />');o=i("divrelationshipcolumns");o!==null&&(o.innerHTML='<img src="/shared/images/ajax-loader.gif" alt="Loading..." />');Spend_Management.svcCustomEntities.getSummarySources(entityid,t[2],n.CustomEntityAdministration.Attributes.Summary.onEditFetchSuccess,n.CustomEntityAdministration.Attributes.Summary.onSourceFail);break}r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Tab).set_enabled(!0);r(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Tab).set_enabled(!0);n.CustomEntityAdministration.Attributes.Summary.Modal.Show()},onEditFetchSuccess:function(t){var f,e,u,o,r,s,v,h,c,l,a;n.CustomEntityAdministration.Attributes.Summary.onSourceSuccess(t);if(n.CustomEntityAdministration.Attributes.lstSummarySrcChanged){for(u=new n.CustomEntityAdministration.Attributes.Summary.JsonObjects.sSummary,o=0;o<n.CustomEntityAdministration.Attributes.summaryEditData[3].length;o++)u=n.CustomEntityAdministration.Attributes.summaryEditData[3][o],f=i("chkRel_"+u.otm_attributeid),f!==null&&(f.checked=!0,i("hiddenRelSAID_"+u.otm_attributeid).value=u.summary_attributeid,e=i("txtRelSeq_"+u.otm_attributeid),e.value=u.order,e.disabled=!1);for(r=new n.CustomEntityAdministration.Attributes.Summary.JsonObjects.sSummaryColumn,s=0;s<n.CustomEntityAdministration.Attributes.summaryEditData[4].length;s++)r=n.CustomEntityAdministration.Attributes.summaryEditData[4][s],f=i("chkCol_"+r.columnAttributeID),f!==null&&(f.checked=!0,i("hiddenColID_"+r.columnAttributeID).value=r.columnid,r.ismtoattribute&&(v=i("mtoFieldLink_"+r.columnAttributeID),v.style.display="",i("txtMTODisplayField_"+r.columnAttributeID).innerHTML=r.displayFieldName==""?"Not Selected":r.displayFieldName,i("hidMTODisplayFieldId_"+r.columnAttributeID).value=r.displayFieldId,i("hidMTOJoinViaId_"+r.columnAttributeID).value=r.JoinViaID),e=i("txtColSequence_"+r.columnAttributeID),e.value=r.order,e.disabled=!1,h=i("txtColAltHeader_"+r.columnAttributeID),h.value=r.alt_header,h.disabled=!1,c=i("txtColWidth_"+r.columnAttributeID),c.value=r.width!==0?r.width:"",c.disabled=!1,l=i("txtColFilter_"+r.columnAttributeID),l.value=r.filterVal,l.disabled=!1,a=i("optDefaultSort_"+r.columnAttributeID),a.disabled=!1,a.checked=r.default_sort);n.CustomEntityAdministration.Attributes.lstSummarySrcChanged=!1;n.CustomEntityAdministration.Attributes.summaryEditData=null}},onSummaryFail:function(t){n.MasterPopup.ShowMasterPopup("An error occurred attempting to retrieve the summary record information\n"+t,n.CustomEntityAdministration.Messages.ModalTitle)},updateSummarySourceDropdown:function(t){var o=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.SummarySource),r,u,f,e;for(o.options.length=0,r=0;r<t.length;r++)u=document.createElement("OPTION"),u.text=t[r].Text,u.value=t[r].Value,o.options.add(u);f=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Relationships.Control);f!==null&&(f.innerHTML='<div class="onecolumnpanel">No current selections available.<\/div>');e=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.Columns.Control);e!==null&&(e.innerHTML='<div class="onecolumnpanel">No current selections available.<\/div>')},Add:function(){if(n.CustomEntityAdministration.IDs.Attribute=0,n.CustomEntityAdministration.Attributes.Summary.ClearSummaryForm(),entityid===0){currentAction="addSummary";n.CustomEntityAdministration.Base.Save();return}Spend_Management.svcCustomEntities.getRelationshipDropDown(entityid,n.CustomEntityAdministration.Forms.RelationshipType.OneToMany,!0,!1,n.CustomEntityAdministration.Attributes.Summary.updateSummarySourceDropdown,n.CustomEntityAdministration.Misc.ErrorHandler);n.CustomEntityAdministration.Attributes.Summary.Modal.Show()},Edit:function(t){n.CustomEntityAdministration.IDs.Attribute=t;n.CustomEntityAdministration.Attributes.Summary.getSummary()},SelectSummaryMTODisplayField:function(t){n.CustomEntityAdministration.Attributes.Summary.DisplayField.currentDisplayFieldAttributeId=t;n.CustomEntityAdministration.Attributes.Summary.DisplayField.Modal.Show()},ColSelectAll:function(){for(var t,u=i("chkColSAll").checked,r=0;r<n.CustomEntityAdministration.Attributes.Summary.columnRels.length;r++)t=i("chkCol_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[r]),t!==null&&(t.checked=u,n.CustomEntityAdministration.Attributes.Summary.RelColRowSwapState(t.id.replace("chkCol_","")))},RelSelectAll:function(){for(var t,u=i("chkRelSAll").checked,r=0;r<n.CustomEntityAdministration.Attributes.Summary.availableRels.length;r++)t=i("chkRel_"+n.CustomEntityAdministration.Attributes.Summary.availableRels[r]),t!==null&&(t.checked=u,n.CustomEntityAdministration.Attributes.Summary.SwapRelState(t.id.replace("chkRel_","")))},RelColRowSwapState:function(n,t){var o=i("chkCol_"+n),s=i("txtColSequence_"+n),r=i("txtColAltHeader_"+n),u=i("txtColWidth_"+n),f=i("txtColFilter_"+n),e=i("optDefaultSort_"+n),h;o.checked?(s.disabled=!1,r.disabled=!1,u.disabled=!1,f.disabled=!1,e.disabled=!1):(s.disabled=!0,r.disabled=!0,r.value="",u.disabled=!0,u.value="",f.disabled=!0,f.value="",e.disabled=!0,e.checked=!1);t&&(h=i("mtoFieldLink_"+n),h.style.display=o.checked?"":"none")},SwapRelState:function(n){var t=i("chkRel_"+n),r=i("txtRelSeq_"+n);r.disabled=t.checked?!1:!0},saveSummary:function(){var f,c,t,e,h,l,o,s,v,r,y,p;if(validateform("vgSummary")!=!1){for(f="",c=!1,t=0;t<n.CustomEntityAdministration.Attributes.Summary.availableRels.length;t++)e=i("chkRel_"+n.CustomEntityAdministration.Attributes.Summary.availableRels[t]),e!==null&&e.checked&&(c=!0,h=i("txtRelSeq_"+n.CustomEntityAdministration.Attributes.Summary.availableRels[t]).value,isNaN(h)?f+="<li>Please enter a valid number for Sequence for the selected relationship on row "+(t+1)+".<\/li>":(h<=0&&(f+="<li>Please enter a number greater than 0 for Sequence for the selected relationship on row "+(t+1)+".<\/li>"),h.indexOf(".")>-1&&(f+="<li>Please enter a whole number for Sequence for the selected relationship on row "+(t+1)+".<\/li>")));for(l=!1,t=0;t<n.CustomEntityAdministration.Attributes.Summary.columnRels.length;t++)o=i("txtColSequence_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value,isNaN(o)?f+="<li>Please enter a valid number for Column Sequence for the selected attribute on row "+(t+1)+".<\/li>":o!==""?(o<=0&&(f+="<li>Please enter a number greater than 0 for the Column Sequence for the selected attribute on row "+(t+1)+".<\/li>"),o.indexOf(".")>-1&&(f+="<li>Please enter a whole number for Sequence for the selected attribute on row "+(t+1)+".<\/li>")):f+="<li>Please enter a valid number for Column Sequence for the selected attribute on row "+(t+1)+".<\/li>",e=i("chkCol_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]),e!==null&&e.checked&&(l=!0,s=i("txtColWidth_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value,isNaN(s)?f+="<li>Please enter a valid number for Column Width for the selected attribute on row "+(t+1)+".<\/li>":s!==""&&(s<=0&&(f+="<li>Please enter a number greater than 0 for the Column Width for the selected attribute on row "+(t+1)+".<\/li>"),s.indexOf(".")>-1&&(f+="<li>Please enter a whole number for Column Width for the selected attribute on row "+(t+1)+".<\/li>")),u("hidMTODisplayFieldId_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t])&&i("hidMTODisplayFieldId_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value===""&&(f+="<li>Please select a Display Field for the selected attribute on row "+(t+1)+".<\/li>"));if(c||(f+="<li>Please select at least one relationship for the summary.<\/li>"),l||(f+="<li>Please select at least one attribute column for the summary.<\/li>"),f.length>0){f='<ul style="margin:0; padding: 0;list-style-type: none;">'+f+"<\/ul>";n.MasterPopup.ShowMasterPopup(f,n.CustomEntityAdministration.Messages.ModalTitle);return}var b=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.Name).value,k=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.Description).value,a=i(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.General.SummarySource),w=0;for(a!==null&&(w=a[a.selectedIndex].value),v=[],t=0;t<n.CustomEntityAdministration.Attributes.Summary.availableRels.length;t++)e=i("chkRel_"+n.CustomEntityAdministration.Attributes.Summary.availableRels[t]),e!==null&&e.checked&&(r=new n.CustomEntityAdministration.Attributes.Summary.JsonObjects.sSummary,r.summary_attributeid=new Number(i("hiddenRelSAID_"+n.CustomEntityAdministration.Attributes.Summary.availableRels[t]).value),r.attributeid=n.CustomEntityAdministration.IDs.Attribute,r.otm_attributeid=n.CustomEntityAdministration.Attributes.Summary.availableRels[t],r.order=new Number(i("txtRelSeq_"+n.CustomEntityAdministration.Attributes.Summary.availableRels[t]).value),v.push(r));for(y=[],p=[],t=0;t<n.CustomEntityAdministration.Attributes.Summary.columnRels.length;t++)e=i("chkCol_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]),e!==null&&e.checked&&(r=new n.CustomEntityAdministration.Attributes.Summary.JsonObjects.sSummaryColumn,r.columnid=new Number(i("hiddenColID_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value),r.attributeid=n.CustomEntityAdministration.IDs.Attribute,r.columnAttributeID=n.CustomEntityAdministration.Attributes.Summary.columnRels[t],r.alt_header=i("txtColAltHeader_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value,r.width=new Number(i("txtColWidth_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value),r.order=new Number(i("txtColSequence_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value),r.filterVal=i("txtColFilter_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value,r.default_sort=i("optDefaultSort_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).checked,r.displayFieldName=u("txtMTODisplayField_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t])?i("txtMTODisplayField_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).innerHTML:"",r.displayFieldId=u("hidMTODisplayFieldId_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t])?i("hidMTODisplayFieldId_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value:"",r.joinViaId=u("hidMTOJoinViaId_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t])?i("hidMTOJoinViaId_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value:0,r.joinViaId=r.joinViaId===""?0:r.joinViaId,y.push(r),r=new n.CustomEntityAdministration.Attributes.Summary.JsonObjects.sJoinViaColumnData,r.columnid=new Number(i("hiddenColID_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value),r.joinViaCrumbs=u("hidMTOJoinViaCrumbs_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t])?i("hidMTOJoinViaCrumbs_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value:"",r.joinViaPath=u("hidMTOJoinViaPath_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t])?i("hidMTOJoinViaPath_"+n.CustomEntityAdministration.Attributes.Summary.columnRels[t]).value:"",r.joinViaCrumbs!==""&&r.joinViaPath!==""&&p.push(r));Spend_Management.svcCustomEntities.saveSummary(n.CustomEntityAdministration.IDs.Entity,n.CustomEntityAdministration.IDs.Attribute,b,k,w,v,y,p,n.CustomEntityAdministration.Attributes.Summary.onSaveSummaryComplete,n.CustomEntityAdministration.Attributes.Summary.onSaveSummaryFail)}},onSaveSummaryComplete:function(t){t===-1?n.MasterPopup.ShowMasterPopup("An attribute or relationship with this Display name already exists.",n.CustomEntityAdministration.Messages.ModalTitle):(n.CustomEntityAdministration.Attributes.Summary.Modal.Hide(),Spend_Management.svcCustomEntities.getAttributesGrid(entityid,RefreshAttributeGridComplete))},onSaveSummaryFail:function(t){n.MasterPopup.ShowMasterPopup("An error occurred attempting to save the summary record information\n"+t,n.CustomEntityAdministration.Messages.ModalTitle)},JsonObjects:{sSummary:function(){this.summary_attributeid=null;this.attributeid=null;this.otm_attributeid=null;this.order=null},sSummaryColumn:function(){this.columnid=null;this.attributeid=null;this.columnAttributeID=null;this.alt_header=null;this.width=null;this.order=null;this.default_sort=null;this.filterVal=null;this.isMTO=null;this.displayFieldId=null;this.displayFieldName=null;this.joinViaId=null},sJoinViaColumnData:function(){this.columnid=null;this.joinViaCrumbs=null;this.joinViaPath=null}},selectDisplayField:function(){var t=n.Trees.Tree.SelectedNode(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.DisplayFieldModal.Tree),r;t.length===0?n.MasterPopup.ShowMasterPopup("A display field has not been selected.",n.CustomEntityAdministration.Messages.ModalTitle):(r=n.Trees.Node.GetText(n.CustomEntityAdministration.DomIDs.Attributes.Summary.Modal.DisplayFieldModal.Tree,t.attr("id")),i("txtMTODisplayField_"+n.CustomEntityAdministration.Attributes.Summary.DisplayField.currentDisplayFieldAttributeId).innerHTML=r,i("hidMTODisplayFieldId_"+n.CustomEntityAdministration.Attributes.Summary.DisplayField.currentDisplayFieldAttributeId).value=t.attr("fieldid"),i("hidMTOJoinViaCrumbs_"+n.CustomEntityAdministration.Attributes.Summary.DisplayField.currentDisplayFieldAttributeId).value=t.attr("crumbs"),i("hidMTOJoinViaPath_"+n.CustomEntityAdministration.Attributes.Summary.DisplayField.currentDisplayFieldAttributeId).value=t.attr("id"),n.CustomEntityAdministration.Attributes.Summary.DisplayField.Modal.Hide())}},Relationship:{Get:function(t){var r=n.CustomEntityAdministration,o=r.Attributes.Relationship,u=r.DomIDs.Attributes.Relationship,e=u.NtoOne.Modal.General,h=u.OnetoN.Modal.General,f=r.IDs.Relationship;r.IDs.Attribute=t;Spend_Management.svcCustomEntities.getRelationship(s.AccountID,entityid,t,function(t){var s;t[0]===2?(s=o.OneToMany,s.Form.Clear(),i("divOneToManyRelationshipHeading").innerHTML="1:n Relationship Attribute: "+t[3],i(h.RelationshipName).value=t[3],i(h.Description).value=t[4],f.SelectedViewID=t[8]):(s=o.ManyToOne,s.Form.Clear(),i("divManyToOneRelationshipHeading").innerHTML="n:1 Relationship Attribute: "+t[3],i(e.RelationshipName).value=t[3],i(e.Description).value=t[4],i(e.Tooltip).value=t[7],i(e.Mandatory).checked=t[5],f.SelectedViewID=null,f.SelectedDisplayField=t[8],f.SelectedMatchFields=t[9],i(u.NtoOne.Modal.Fields.MaxRows).value=t[10],f.RelatedTable=t[6],s.Tabs.Filters.Tree.Refresh(),n.Trees.Tree.Data.Load.DroppedNodes(u.NtoOne.Modal.Filters.Drop,{entityId:r.IDs.Entity,attributeId:r.IDs.Attribute}),s.Tabs.LookupDisplayFields.Tree.Refresh(),n.Trees.Tree.Data.Load.DroppedNodes(u.NtoOne.Modal.LookupDisplayFields.Drop,{entityId:r.IDs.Entity,attributeId:r.IDs.Attribute}));r.IDs.Relationship.SelectedRelationshipEntity=t[6];s.Modal.Show()},n.Common.WebService.ErrorHandler)},ManyToOne:{Add:function(){var t=n.CustomEntityAdministration,r=t.Attributes.Relationship.ManyToOne;t.IDs.Attribute=0;i(t.DomIDs.Attributes.Relationship.NtoOne.Modal.General.RelationshipEntity).disabled=!1;r.Form.Clear();r.Modal.Show()},Form:{Clear:function(){var s=n.CustomEntityAdministration,t=s.DomIDs.Attributes.Relationship.NtoOne.Modal,e=t.General,f=t.Fields,o=s.IDs.Relationship,h,c;n.Common.Page_ClientValidateReset();h=i(e.RelationshipEntity);h.selectedIndex=0;i(e.RelationshipName).value="";i(e.Description).value="";i(e.Tooltip).value="";i(e.Mandatory).checked=!1;u(f.MatchFields)&&(i(f.MatchFields).options.length=0,i(f.MatchFields).selectedIndex=-1);u(f.DisplayField)&&(i(f.DisplayField).options.length=0,i(f.DisplayField).selectedIndex=-1);o.SelectedRelationshipEntity=null;o.SelectedDisplayField=null;o.SelectedMatchFields=null;o.SelectedViewID=null;i(f.MaxRows).value="";c=r(t.TabContainer);c!==null&&(r(t.TabContainer).get_tabs()[1].set_enabled(!1),r(t.TabContainer).get_tabs()[2].set_enabled(!1),r(t.TabContainer).get_tabs()[3].set_enabled(!1));n.Trees.Tree.Clear(t.Filters.Tree);n.Trees.Tree.Clear(t.Filters.Drop);n.Trees.Tree.Clear(t.LookupDisplayFields.Tree);n.Trees.Tree.Clear(t.LookupDisplayFields.Drop);return}},Modal:{Show:function(){var o=n.CustomEntityAdministration,c=o.Attributes.Relationship.ManyToOne,h=o.IDs,l=o.DomIDs.Attributes.Relationship.NtoOne.Modal,s=l.General,a=h.Relationship,v=t("#imgManyToOneFilterHelp"),y=t("#imgDisplayFieldHelp"),f=t("#displayFieldHelpArea"),e=t("#relFilterHelpArea");if(o.Base.RemoveAllShortCuts(),a.RelationshipType=o.Forms.RelationshipType.ManyToOne,h.Entity===0){currentAction="addRelationship1";o.Base.Save();return}y.css("display","none");y.mouseenter(function(){f.css("zIndex",n.CustomEntityAdministration.zIndices.Views.HelpIcon());f.css("left",t(this).offset().left-f.outerWidth());f.css("top",t(this).offset().top-f.outerHeight());f.css("position","absolute");f.stop(!0,!0).fadeIn(400)}).mouseleave(function(){f.stop(!0,!0).fadeOut(200)});v.css("display","none");v.mouseenter(function(){e.css("zIndex",n.CustomEntityAdministration.zIndices.Views.HelpIcon());e.css("left",t(this).offset().left-e.outerWidth());e.css("top",t(this).offset().top-e.outerHeight());e.css("position","absolute");e.stop(!0,!0).fadeIn(400)}).mouseleave(function(){e.stop(!0,!0).fadeOut(200)});h.Attribute===0&&(i("divManyToOneRelationshipHeading").innerHTML="New n:1 Relationship Attribute");i(s.MandatoryLabel).style.display="";t("#RelModContainer").css("height","315px");Spend_Management.svcCustomEntities.getRelationshipDropDown(h.Entity,1,!1,!1,function(f){var h,e,v,y,p;if(u(s.RelationshipEntity)===!0)for(h=i(s.RelationshipEntity),h.options.length=0,e=0;e<f.length;e++)v=document.createElement("OPTION"),v.text=f[e].Text,v.value=f[e].Value,h.options.add(v),f[e].Value===a.SelectedRelationshipEntity&&(h.selectedIndex=e);y=l.Control;p=o.zIndices.Attributes.Relationship.Modal;c.GetLookupOptions();n.Common.ShowModal(y);r(y)._backgroundElement.style.zIndex=p-5;r(y)._popupElement.style.zIndex=p;t("#"+s.RelationshipName).select();t("#"+s.RelationshipEntity).change(function(){return c.Tabs.Filters.Tree.Refresh(),c.Tabs.LookupDisplayFields.Tree.Refresh(),!1})},n.Common.WebService.ErrorHandler);t("#"+l.TabContainer+"_body").css("height","")},Close:function(){t("#imgManyToOneFilterHelp").css("display","none");t("#imgDisplayFieldHelp").css("display","none");n.CustomEntityAdministration.Base.RemoveAllShortCuts();n.Common.HideModal(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Control)},TabChange:function(i){var l=t("#RelModContainer"),f;if(l.is(":visible")){var c=n.CustomEntityAdministration,u=c.DomIDs.Attributes.Relationship.NtoOne.Modal,h="315px",s=!1,r=[],e=t("#imgManyToOneFilterHelp"),o=t("#imgDisplayFieldHelp");c.Base.RemoveAllShortCuts();e.css("display","none");o.css("display","none");switch(i.get_activeTabIndex()){case 1:c.Base.AddShortCuts("relationshipModal");h="235px";r.push(u.Fields.Tab);s=!1;break;case 2:h="450px";r.push(u.LookupDisplayFields.Tab);r.push(u.LookupDisplayFields.Tree);r.push(u.LookupDisplayFields.Drop);s="displayfield";break;case 3:h="450px";r.push(u.Filters.Tab);r.push(u.Filters.Tree);r.push(u.Filters.Drop);s="filter";break;default:r.push(u.General.Tab)}for(f=0;f<r.length;f++)t("#"+r[f]).stop(!0,!0).css("display","none");for(l.stop(!0,!0).animate({height:h},"600",function(){s==="filter"?(e.css("display","inline-block"),e.css("left",e.parent().outerWidth()-25),e.css("top",e.parent().outerHeight()+15)):s==="displayfield"&&(o.css("display","inline-block"),o.css("left",o.parent().outerWidth()-25),o.css("top",o.parent().outerHeight()+15));t("#"+u.TabContainer+"_body").css("height","")}),f=0;f<r.length;f++)t("#"+r[f]).fadeIn(600);i.get_activeTabIndex()==2&&n.Trees.Node.Disable(u.LookupDisplayFields.Tree,null,"refresh")}}},GetLookupOptions:function(){var s=n.CustomEntityAdministration,h=s.IDs,t=s.DomIDs.Attributes.Relationship.NtoOne.Modal,c=t.General,f=t.Fields,l=h.Relationship,e,o;u(c.RelationshipEntity)===!0&&(e=i(c.RelationshipEntity),o=e.options[e.selectedIndex].value!=="0",r(t.TabContainer).get_tabs()[1].set_enabled(o),r(t.TabContainer).get_tabs()[2].set_enabled(o),r(t.TabContainer).get_tabs()[3].set_enabled(o),Spend_Management.svcAutoComplete.getRelationshipLookupOptions(e.options[e.selectedIndex].value,[],function(t){var e,r,o;if(t!==null){if(u(f.DisplayField)===!0&&(o=i(f.DisplayField),o!==null))for(o.options.length=0,i(f.MatchFields).options.length=0,r=document.createElement("OPTION"),r.text=s.Messages.NoneOption,r.value="0",o.options.add(r),e=0;e<t.length;e++)r=document.createElement("OPTION"),r.text=t[e].Text,r.value=t[e].Value,t[e].Value===l.SelectedDisplayField&&(r.selected=!0),o.options.add(r);h.Attribute!==0&&Spend_Management.svcCustomEntities.getRelationshipMatchSelections(h.Attribute,function(n){var r,t,e;if(u(f.MatchFields)===!0&&(r=i(f.MatchFields),r!==null))for(r.options.length=0,t=0;t<n.length;t++)e=document.createElement("OPTION"),e.text=n[t].Text,e.value=n[t].Value,r.options.add(e)},n.Common.WebService.ErrorHandler)}},n.Common.WebService.ErrorHandler))},Save:function(){var p,o,h;if(EnableAttributeValidators("relationship"),validateform("vgManyToOneRelationship")!==!1){var c=n.CustomEntityAdministration,w=n.CustomEntityAdministration.IDs,b=w.Entity,st=w.Attribute,l=c.Misc,a=c.Messages,k=a.Attributes.Relationship,e=c.DomIDs.Attributes.Relationship.NtoOne.Modal,f=e.General,r=e.Fields,d,g,nt,tt,v,it,ht=e.Filters.Drop,rt,y,ut=null,ft=[],et=15,ct=e.LookupDisplayFields.Drop,ot;if(l.LoadingScreenCancelled=!1,setTimeout(function(){l.ShowInformationMessage("Saving...")},300),rt=n.Trees.Tree.Data.Get(ht,["metadata"]),ot=n.Trees.Tree.Data.Get(ct,["metadata"]),d=i(f.RelationshipName).value,g=i(f.Description).value,nt=i(f.Tooltip).value,tt=i(f.Mandatory).checked,v=i(f.RelationshipEntity),it=v.options[v.selectedIndex].value,u(r.DisplayField)===!0&&(y=i(r.DisplayField),ut=y.options[y.selectedIndex].value),u(r.MatchFields)===!0)for(p=i(r.MatchFields),o=0;o<p.options.length;o++)ft.push(p[o].value);u(r.MaxRows)===!0&&(h=i(r.MaxRows),h.value!==""&&h.value!=="0"&&(et=new Number(h.value)));Spend_Management.svcCustomEntities.saveManyToOneRelationship(s.AccountID,employeeid,b,st,d,g,nt,tt,it,ut,ft,et,rt,ot,function(i){i===-1?n.MasterPopup.ShowMasterPopup(k.DuplicateName,a.ModalTitle):i===-2?n.MasterPopup.ShowMasterPopup(k.RecursionWarning,a.ModalTitle):(n.CustomEntityAdministration.Attributes.Relationship.ManyToOne.Modal.Close(),Spend_Management.svcCustomEntities.getAttributesGrid(b,RefreshAttributeGridComplete));l.LoadingScreenCancelled=!0;t("#loadingArea").fadeOut(600,function(){t("#loadingArea").remove()})},n.CustomEntityAdministration.Misc.ErrorHandler)}},FieldItem:{Modal:{Show:function(t){var f,e,o,r;if(t&&n.Common.Page_ClientValidateReset(),f=[],u(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFields)===!0&&u(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.General.RelationshipEntity)===!0){for(e=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFields),o=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.General.RelationshipEntity),r=0;r<e.length;r++)f.push(e.options[r].value);Spend_Management.svcAutoComplete.getRelationshipLookupOptions(o.options[o.selectedIndex].value,f,function(t){var e,r,f;if(u(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldSelector.FieldItems)===!0)for(e=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldSelector.FieldItems),e.options.length=0,r=document.createElement("OPTION"),r.text=n.CustomEntityAdministration.Messages.NoneOption,r.value="0",e.options.add(r),f=0;f<t.length;f++)r=document.createElement("OPTION"),r.text=t[f].Text,r.value=t[f].Value,e.options.add(r);n.Common.ShowModal(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldSelector.Modal.Control)},n.Common.WebService.ErrorHandler)}},Close:function(){n.Common.HideModal(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldSelector.Modal.Control)}},Save:function(){var t,f,e,r,o;return validateform("vgFieldItemList")===!1?!1:(t="",u(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldSelector.FieldItems)===!0&&(f=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldSelector.FieldItems),t=f.options[f.selectedIndex]),u(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFields)===!0&&(e=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFields),e!==null&&(r=document.createElement("OPTION"),r.text=t.text,r.value=t.value,e.options.add(r),o=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldsReqValidator),o.isvalid=!0,c(o))),n.CustomEntityAdministration.Attributes.Relationship.ManyToOne.FieldItem.Modal.Close(),!1)},Remove:function(){var t,r,f;u(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFields)===!0&&(t=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFields),t.selectedIndex!==-1?(t.remove(t.selectedIndex),t.length===0&&(r=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFieldsReqValidator),r.isvalid=!1,c(r))):(f=n.CustomEntityAdministration.Messages.Attributes.Relationship.SelectRemovalItem,t.length===0&&(f=n.CustomEntityAdministration.Messages.Attributes.Relationship.NoRemovalItems),n.MasterPopup.ShowMasterPopup(f,n.CustomEntityAdministration.Messages.ModalTitle)))}},ValidateFieldMatchList:function(t,r){var u=i(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.NtoOne.Modal.Fields.MatchFields).options;r.IsValid=u.length>0?!0:!1},Tabs:{Filters:{Tree:{Refresh:function(){var i=n.CustomEntityAdministration,u=i.DomIDs.Attributes.Relationship.NtoOne.Modal.Filters.Tree,r=t("#"+i.DomIDs.Attributes.Relationship.NtoOne.Modal.General.RelationshipEntity);r.val()!==null&&r.val()!=="0"&&(i.IDs.Relationship.RelatedTable=r.val());n.Trees.Tree.Clear(u);i.IDs.Relationship.RelatedTable!==null&&n.Trees.Tree.Data.Load.InitialNodes(u,{relatedTable:i.IDs.Relationship.RelatedTable},null,i.Misc.ErrorHandler)}},Drop:{Refresh:function(){var t=n.CustomEntityAdministration,i=t.IDs,r=t.DomIDs.Attributes.Relationship.NtoOne.Modal.Filters.Drop;n.Trees.Tree.Clear(r);n.Trees.Tree.Data.Load.DroppedNodes(r,{entityId:i.Entity,attributeId:i.Attribute},t.Attributes.Relationship.ManyToOne.Modal.Show,t.Misc.ErrorHandler)}}},LookupDisplayFields:{Tree:{Refresh:function(){var i=n.CustomEntityAdministration,u=i.DomIDs.Attributes.Relationship.NtoOne.Modal.LookupDisplayFields.Tree,r=t("#"+i.DomIDs.Attributes.Relationship.NtoOne.Modal.General.RelationshipEntity);r.val()!==null&&r.val()!=="0"&&(i.IDs.Relationship.RelatedTable=r.val());n.Trees.Tree.Clear(u);i.IDs.Relationship.RelatedTable!==null&&n.Trees.Tree.Data.Load.InitialNodes(u,{relatedTable:i.IDs.Relationship.RelatedTable},null,i.Misc.ErrorHandler)}},Drop:{Refresh:function(){var t=n.CustomEntityAdministration,i=t.IDs,r=t.DomIDs.Attributes.Relationship.NtoOne.Modal.LookupDisplayFields.Drop;n.Trees.Tree.Clear(r);n.Trees.Tree.Data.Load.DroppedNodes(r,{entityId:i.Entity,attributeId:i.Attribute},t.Attributes.Relationship.ManyToOne.Modal.Show,t.Misc.ErrorHandler)}}}}},OneToMany:{Add:function(){var t=n.CustomEntityAdministration,r=t.Attributes.Relationship.OneToMany;t.IDs.Attribute=0;i(t.DomIDs.Attributes.Relationship.OnetoN.Modal.General.RelationshipEntity).disabled=!1;r.Form.Clear();r.Modal.Show()},Form:{Clear:function(){var r=n.CustomEntityAdministration,o=r.DomIDs.Attributes.Relationship.OnetoN.Modal,t=o.General,f=r.IDs.Relationship,e;n.Common.Page_ClientValidateReset();e=i(t.RelationshipEntity);e.selectedIndex=0;i(t.RelationshipName).value="";i(t.Description).value="";u(t.RelationshipView)&&(i(t.RelationshipView).options.length=0,i(t.RelationshipView).selectedIndex=-1);f.SelectedRelationshipEntity=null;f.SelectedViewID=null;return}},Modal:{Show:function(){var f=n.CustomEntityAdministration,l=f.Attributes.Relationship.OneToMany,e=f.IDs,h=f.DomIDs.Attributes.Relationship.OnetoN.Modal,o=h.General,s=e.Relationship,c=!1;if(f.Base.RemoveAllShortCuts(),s.RelationshipType=f.Forms.RelationshipType.OneToMany,e.Entity===0){currentAction="addRelationship2";f.Base.Save();return}t("#imgManyToOneFilterHelp").css("display","none");e.Attribute===0&&(i("divOneToManyRelationshipHeading").innerHTML="New 1:n Relationship Attribute",c=!0);t("#RelModContainer").css("height","280px");Spend_Management.svcCustomEntities.getRelationshipDropDown(e.Entity,s.RelationshipType,!1,c,function(e){var a,c,v,y,p;if(u(o.RelationshipEntity)===!0)for(a=i(o.RelationshipEntity),a.options.length=0,c=0;c<e.length;c++)v=document.createElement("OPTION"),v.text=e[c].Text,v.value=e[c].Value,a.options.add(v),e[c].Value===s.SelectedRelationshipEntity&&(a.selectedIndex=c);y=h.Control;p=f.zIndices.Attributes.Relationship.Modal;l.GetViews();n.Common.ShowModal(y);r(y)._backgroundElement.style.zIndex=p-5;r(y)._popupElement.style.zIndex=p;t("#"+o.RelationshipName).select()},n.Common.WebService.ErrorHandler)},Close:function(){t("#imgManyToOneFilterHelp").css("display","none");n.CustomEntityAdministration.Base.RemoveAllShortCuts();n.Common.HideModal(n.CustomEntityAdministration.DomIDs.Attributes.Relationship.OnetoN.Modal.Control)}},GetViews:function(){var t=n.CustomEntityAdministration,e=t.IDs,o=t.DomIDs.Attributes.Relationship.OnetoN.Modal,r=o.General,u=e.Relationship,f;u.RelationshipType!==null&&u.RelationshipType!==t.Forms.RelationshipType.ManyToOne&&(f=i(r.RelationshipEntity).options[i(r.RelationshipEntity).selectedIndex].value,Spend_Management.svcCustomEntities.getRelationshipViews(s.AccountID,f,function(n){var f=document.getElementById(r.RelationshipView),e=-1,t,i,o;for(f.options.length=0,t=0;t<n.length;t++)i=document.createElement("OPTION"),i.text=n[t].Text,i.value=n[t].Value,f.options.add(i),o=parseInt(n[t].Value,10),o===u.SelectedViewID&&(e=t);e>-1&&(f.selectedIndex=e)},n.Common.WebService.ErrorHandler))},Save:function(){if(EnableAttributeValidators("relationship"),validateform("vgOneToManyRelationship")!==!1){var r=n.CustomEntityAdministration,f=n.CustomEntityAdministration.IDs,e=f.Entity,l=f.Attribute,a=r.DomIDs.Attributes.Relationship.OnetoN.Modal,t=a.General,u=r.Messages,o=u.Attributes.Relationship,v=i(t.RelationshipName).value,y=i(t.Description).value,h=i(t.RelationshipEntity),p=h.options[h.selectedIndex].value,c=0;i(t.RelationshipView).options.length>0&&(c=i(t.RelationshipView).options[i(t.RelationshipView).selectedIndex].value);Spend_Management.svcCustomEntities.saveOneToManyRelationship(s.AccountID,employeeid,e,l,v,y,"",!1,p,c,function(t){t===-1?n.MasterPopup.ShowMasterPopup(o.DuplicateName,u.ModalTitle):t===-2?n.MasterPopup.ShowMasterPopup(o.RecursionWarning,u.ModalTitle):(r.Attributes.Relationship.OneToMany.Modal.Close(),Spend_Management.svcCustomEntities.getAttributesGrid(e,RefreshAttributeGridComplete))},n.Common.WebService.ErrorHandler)}}}},IsFormSelectionAttribute:function(i){return+t("#"+n.CustomEntityAdministration.DomIDs.Base.FormSelectionAttribute).val()===i}},Forms:{FormObj:null,FieldsUsedOnForm:[],FormFieldDetails:[],NumberOfSpacers:1,NumberOfTabs:0,NumberOfSections:0,SelectedTab:null,SelectedSection:null,EditTabObject:null,EditTabMode:!1,EditSectionMode:!1,EditSectionObject:null,EditLabelField:null,CurrentlyDragging:!1,SortEventCancelled:!1,ControlTypeObject:{Tab:0,Section:1,Field:2},CurrentFormID:0,FormsWebServiceError:function(i){n.CustomEntityAdministration.Misc.LoadingScreenCancelled=!0;t("#loadingArea").remove();n.MasterPopup.ShowMasterPopup('An error has occurred processing your request.<span style="display:none;">'+(i._message?i._message:i)+"<\/span>","Message from "+l)},NewForm:function(){var i=n.CustomEntityAdministration.Forms;if(entityid===0){currentAction="addForm";n.CustomEntityAdministration.Base.Save();return}i.ResetFormButtonTextLabels();i.EditTabObject=null;i.EditTabMode=!1;i.ShowFormModal(!0);i.FieldsUsedOnForm=[];i.NumberOfSpacers=1;i.NumberOfTabs=0;i.NumberOfSections=0;i.SelectedTab=null;i.SelectedSection=null;t("#divFormSectionHeader").text("New Form");i.CreateNoTabsAndSectionsComments()},EditForm:function(t){var r=n.CustomEntityAdministration.Misc,i=n.CustomEntityAdministration.Forms;document.getElementById("formTabs").innerHTML="";document.getElementById("tabBar").innerHTML="";document.getElementById("addTabHolder").innerHTML="";i.CurrentFormID=t;r.LoadingScreenCancelled=!1;setTimeout(function(){r.ShowInformationMessage("Loading...")},300);Spend_Management.svcCustomEntities.getForm(s.AccountID,entityid,t,i.GetFormComplete,i.FormsWebServiceError)},ShowCopyModal:function(r){var f=i(reqNewFormNameID),u;f.isvalid=!0;c(f);u=t("#"+txtcopyformnameid);Spend_Management.svcCustomEntities.GetFormNameById(entityid,r,function(t){u.val(t.substring(0,93)+" (Copy)");u.attr("copyformid",r);n.Common.ShowModal(modcopyformid);u.select()},n.CustomEntityAdministration.Misc.ErrorHandler)},HideCopyModal:function(){t("#"+txtcopyformnameid).attr("copyformid","");n.Common.HideModal(modcopyformid);n.CustomEntityAdministration.Base.RemoveAllShortCuts()},Copy:function(){if(validateform("vgCopyForm")!==!1){var i=n.CustomEntityAdministration.Misc,r=n.CustomEntityAdministration.Forms,u=t("#"+txtcopyformnameid),f=EscapeHTMLInString(u.val());i.LoadingScreenCancelled=!1;setTimeout(function(){i.ShowInformationMessage("Creating copy...")},50);Spend_Management.svcCustomEntities.CopyForm(entityid,u.attr("copyformid"),f,function(u){if(u<0){i.LoadingScreenCancelled=!0;t("#loadingArea").remove();switch(u){case-1:n.MasterPopup.ShowMasterPopup("The Form name you have entered already exists.","Message from "+l);break;case-6:n.MasterPopup.ShowMasterPopup("Please enter a New Form name.","Message from "+l);break;case-9:n.MasterPopup.ShowMasterPopup("This Form cannot be copied as it is invalid.","Message from "+l)}return}Spend_Management.svcCustomEntities.getFormGrid(entityid,r.RefreshFormGridComplete);i.LoadingScreenCancelled=!0;r.HideCopyModal();t("#loadingArea").fadeOut(600,function(){t("#loadingArea").remove()})},n.CustomEntityAdministration.Misc.ErrorHandler)}},GetFormComplete:function(r){var e=n.CustomEntityAdministration.Misc,f=n.CustomEntityAdministration.Forms,u=r[0],o=r[1];o>30?e.ShowInformationMessage("Loading..."):e.LoadingScreenCancelled=!0;setTimeout(function(){var r,a;f.FieldsUsedOnForm=[];f.NumberOfSpacers=1;f.NumberOfTabs=0;f.NumberOfSections=0;f.SelectedTab=null;f.EditTabObject=null;f.SelectedSection=null;f.EditTabMode=!1;r=null;a=0;i(txtformnameid).value=u.formName;t("#divFormSectionHeader").text("Form: "+u.formName);i(txtformdescriptionid).value=u.description;i(txtformsavebuttontextid).value=u.saveButtonText;i(txtformsaveandduplicatebuttontextid).value=u.saveAndDuplicateButtonText;i(txtformsaveandstaybuttontextid).value=u.saveAndStayButtonText;i(txtformsaveandnewbuttontextid).value=u.saveAndNewButtonText;i(txtformcancelbuttontextid).value=u.cancelButtonText;i(chkshowsubmenuid).checked=u.showSubMenus;i(chkshowbreadcrumbsid).checked=u.showBreadcrumbs;t("#"+chkHideTorch).prop("checked",u.hideTorch);t("#"+chkHideAttachments).prop("checked",u.hideAttachments);t("#"+chkHideAudiences).prop("checked",u.hideAudiences);var o=i(lblsavebuttontextid),s=i(lblsaveandduplicatebuttontextid),h=i(lblsaveandstaybuttontextid),c=i(lblsaveandnewbuttontextid),l=i(lblcancelbuttontextid);o.className="";s.className="";h.className="";c.className="";l.className="";o.innerHTML=o.innerHTML.replace("*","");s.innerHTML=s.innerHTML.replace("*","");h.innerHTML=h.innerHTML.replace("*","");c.innerHTML=c.innerHTML.replace("*","");l.innerHTML=l.innerHTML.replace("*","");f.FormObj=u;n.CustomEntityAdministration.Forms.CreateNoTabsAndSectionsComments();t(u.tabs).each(function(n,i){f.AddTab(i.TabName,!1);f.sectionsInCurrentTab=0;t(i.Sections).each(function(n,t){f.AddSection(t.SectionName,!1,null,t.SectionControlName);r=t.Fields;f.DisplaySectionFields(t.SectionControlName+"_FieldsArea",r);a++})});u.tabs.length>0&&f.ChangeTab(u.tabs[0].TabControlName);f.ShowFormModal(!1);e.LoadingScreenCancelled=!0;t("#loadingArea").fadeOut(600,function(){t("#loadingArea").remove()})},50)},AddSection:function(r,u,f,e){var o=n.CustomEntityAdministration.Forms,w=!0,p,b,k,s,h,l,a,y,d,v;if(o.EditTabObject!==null&&o.EditTabObject!==undefined&&o.EditTabObject!==""&&o.EditTabObject!==o.SelectedTab&&(f=o.EditTabObject.attr("id"),f!==o.SelectedTab&&(w=!1)),p=t("#"+btnSaveSectionid).attr("targetTab"),p!==undefined&&p!==""&&(f=p,t("#"+btnSaveSectionid).removeAttr("targetTab"),w=!0),(f===undefined||f===null)&&(f=o.SelectedTab),(e===undefined||e===null)&&(e=f+"_Section_"+o.NumberOfSections),u){if(validateform("vgSectionHeader")==!1)return;if(b=!0,o.EditSectionObject!==null&&o.EditSectionObject!==undefined&&o.EditSectionObject!==""&&r===o.EditSectionObject.attr("sectionname")&&(b=!1),b&&o.CheckSectionNameExists(r,f)){n.MasterPopup.ShowMasterPopup("Cannot add a section with this name as one already exists on this tab.",n.CustomEntityAdministration.Messages.ModalTitle);k=i(reqSectionHeaderID);k.isvalid=!1;c(k);return}}if(o.EditSectionMode){o.EditSection(r);return}if(s=document.createElement("div"),s.setAttribute("class","customentityformsection"),s.setAttribute("className","customentityformsection"),s.setAttribute("sectionname",r),s.id=e,h=document.createElement("div"),h.setAttribute("class","sectiontitle"),h.setAttribute("className","sectiontitle"),h.id=e+"_Title",h.style.position="relative",h.innerHTML=r,s.appendChild(h),l=document.createElement("div"),l.setAttribute("class","sectionsortables"),l.setAttribute("className","sectionsortables"),l.id=e+"_FieldsArea",s.appendChild(l),document.getElementById(f).appendChild(s),o.SelectedSection=l.id,a=document.createElement("img"),a.setAttribute("id","options_img_"+e),a.setAttribute("src","../images/icons/16/Plain/gear.png"),a.setAttribute("alt","Options"),a.setAttribute("title","Options"),a.className="sm_form_editor_section_btn",h.appendChild(a),a.onclick=function(){o.ShowFormOptions(this.id,o.ControlTypeObject.Section,s.id,null);o.SelectedSection=l.id},u)for(y=new o.SectionObject,y.SectionName=r,y.SectionControlName=e,d=f!=""?f:o.SelectedTab,v=0;v<o.FormObj.tabs.length;v++)if(o.FormObj.tabs[v].TabControlName===d){y.Order=o.FormObj.tabs[v].Sections.length;o.FormObj.tabs[v].Sections.push(y);break}o.NumberOfSections++;w&&o.CreateNoTabsAndSectionsComments();h.onclick=function(){o.SelectedSection=l.id};u&&(o.MakeSectionFieldsSortable(),o.MakeSpacerFieldDraggable(),o.MakeAvailableFieldsDraggable(),o.MakeAvailableFieldsDroppable(),o.HideSectionModal())},EditSection:function(i){var r=n.CustomEntityAdministration.Forms,e,s,u,f,o;for(i=EscapeHTMLInString(i).replace(/</g,"").replace(/>/g,""),e=r.EditSectionObject.attr("id"),r.EditSectionObject.attr("sectionname",i),s=t("#"+e+"_Title"),s.text(i),u=document.createElement("img"),u.setAttribute("id","options_img_"+e),u.setAttribute("src","../images/icons/16/Plain/gear.png"),u.setAttribute("alt","Options"),u.setAttribute("title","Options"),u.className="sm_form_editor_section_btn",s.append(u),u.onclick=function(){r.ShowFormOptions(this.id,r.ControlTypeObject.Section,e,null);r.SelectedSection=e},f=0;f<r.FormObj.tabs.length;f++)if(r.FormObj.tabs[f].TabControlName===r.SelectedTab)for(o=0;o<r.FormObj.tabs[f].Sections.length;o++)if(r.FormObj.tabs[f].Sections[o].SectionControlName===e){r.FormObj.tabs[f].Sections[o].SectionName=i;break}r.HideSectionModal()},CheckSectionNameExists:function(t,i){var u=n.CustomEntityAdministration.Forms,r,f;for(i===undefined&&(i=u.SelectedTab),r=0;r<u.FormObj.tabs.length;r++)if(u.FormObj.tabs[r].TabControlName===i)for(f=0;f<u.FormObj.tabs[r].Sections.length;f++)if(u.FormObj.tabs[r].Sections[f].SectionName.toLowerCase()===t.toLowerCase())return!0;return!1},DisplaySectionFields:function(t,i){for(var f,e=n.CustomEntityAdministration.Forms,u=0,r=0,o=e.SpacerField(),s=0;s<i.length;s++){for(f=i[s];u<f.Row;)f.ColumnSpan===2&&r===1&&f.Row-u==1?(r=0,u++):(o.AttributeID=e.NumberOfSpacers,e.NewField(t,o),r===0?r=1:(u++,r=0),e.NumberOfSpacers++);while(r<f.Column)f.ColumnSpan===2&&r===1&&f.Row-u==1?(r=0,u++):(o.AttributeID=e.NumberOfSpacers,e.NewField(t,o),r===0?r=1:(u++,r=0),e.NumberOfSpacers++);e.NewField(t,f);f.ColumnSpan===1?r===0?r=1:(u++,r=0):(r===1&&(u++,r=0),u++)}},HideSectionModal:function(){var r=n.CustomEntityAdministration.Forms;r.EditSectionMode=!1;r.EditSectionObject=null;t("#"+btnSaveSectionid).removeAttr("targetTab");n.Common.HideModal(modsectionid);i(txtsectionid).blur();n.CustomEntityAdministration.Base.AddShortCuts("formDesigner")},ShowFormModal:function(u){var f=n.CustomEntityAdministration.Forms,e,v,a,l,o,h,c,s;n.Common.Page_ClientValidateReset();t(document).click(function(n){n.target.id.indexOf("options_img_")===-1&&f.HideFormOptions()});$find(tabConFormsID).set_activeTabIndex(0);f.FormFieldDetails=[];u&&(f.FormObj=new f.FormObject,f.CurrentFormID=0,document.getElementById("tabBar").innerHTML="",document.getElementById("addTabHolder").innerHTML="",document.getElementById("formTabs").innerHTML="",f.ClearFormModal());entityid==0&&n.CustomEntityAdministration.Base.Save();e=document.createElement("span");v=i("addTabHolder");e.innerHTML='<img id="tab_left_img_add" alt="" src="../images/backgrounds/tabs/tab_left_img.png" /><span id="tab_middle_img_add" class="sm_tabheader_middle">&nbsp;<img alt="New tab" title="New tab" src="'+StaticLibPath+'/icons/Custom/GreenPlus.png" class="sm_form_editor_tab_btn" />New Tab&nbsp;<\/span><img id="tab_right_img_add" alt="" src="../images/backgrounds/tabs/tab_right_img.png" />';e.setAttribute("class","sm_tabheader");e.setAttribute("className","sm_tabheader");e.id="add_new_tab";e.onclick=function(){f.ShowTabModal()};v.appendChild(e);f.CreateNoTabsComments();f.GetFieldDetails();n.Common.ShowModal(modformid);f.SetupFormModalInformationIcon();r(modformid)._backgroundElement.style.zIndex=n.CustomEntityAdministration.zIndices.Forms.Modal-5;r(modformid)._popupElement.style.zIndex=n.CustomEntityAdministration.zIndices.Forms.Modal;a=t("#spacerArea");a.html("");l=document.createElement("span");l.id="spacerDragHandle";o=document.createElement("img");o.setAttribute("id","draghandle_spacer");o.setAttribute("src",StaticLibPath+"/icons/Custom/HandleBar.png");o.setAttribute("alt","");o.setAttribute("title","Click here to drag a spacer onto the form");t(o).css("width","19px").css("height","16px").css("padding","7px 0px");l.appendChild(o);h=document.createElement("span");h.className="sm_field_spacer";h.id="sm_field_spacer";c=document.createElement("span");c.id="spacerAreaText";c.innerHTML="Spacer";c.setAttribute("isSpacer","true");h.appendChild(l);h.appendChild(c);a.append(h);t("#availableFieldDoms").html("");s=new f.FieldObject;s.AttributeID=0;s.ControlName="form_attribute_spacer";s.DisplayName="Spacer";s.FieldType=20;s.Format=1;s.ColumnSpan=1;f.NewField("availableFieldDoms",f.SpacerField());t("#form_attribute_spacer_0_optionsmenu").remove();f.MakeSpacerFieldDraggable();f.MakeFormModalDroppable();t("#"+txtformnameid).select();t("#sm_field_spacer, #tabBar").on("mousedown",function(){t(this).addClass("closedhand")});t("#availableFields").on("mousedown",function(){t("#availableFields > span").addClass("closedhand")});t("#"+chkHideAttachments).prop("disabled",!0);t("#"+chkenableattachmentsid).is(":checked")&&t("#"+chkHideAttachments).prop("disabled",!1);t("#"+chkHideAudiences).prop("disabled",!0);t("#"+chkEnableAudiencesID).is(":checked")&&t("#"+chkHideAudiences).prop("disabled",!1);t("#"+chkHideTorch).prop("disabled",!0);t("#"+chkallowdocmergeid).is(":checked")&&t("#"+chkHideTorch).prop("disabled",!1)},SetupFormModalInformationIcon:function(){t("#imgFormDesignerHelp").css("display","inline-block");var i=t("#imgFormDesignerHelp");i.css("display","none");i.css("left",i.parent().outerWidth()-38);i.css("top",i.parent().outerHeight()-38);t("#imgFormDesignerHelp").mouseenter(function(){var i=t("#formDesignerHelpArea");i.css("zIndex",n.CustomEntityAdministration.zIndices.Forms.AvailableFields());i.css("left",t(this).offset().left-i.outerWidth());i.css("top",t(this).offset().top-i.outerHeight());i.css("position","absolute");i.stop(!0,!0).fadeIn(400)}).mouseleave(function(){t("#formDesignerHelpArea").stop(!0,!0).fadeOut(200)})},ClearFormModal:function(){document.getElementById(txtformnameid).value="";document.getElementById(txtformdescriptionid).value="";document.getElementById(txtformsavebuttontextid).value="";document.getElementById(txtformsaveandduplicatebuttontextid).value="";document.getElementById(txtformsaveandstaybuttontextid).value="";document.getElementById(txtformsaveandnewbuttontextid).value="";document.getElementById(txtformcancelbuttontextid).value="";document.getElementById(chkshowsubmenuid).checked=!1;document.getElementById(chkshowbreadcrumbsid).checked=!1},GetFieldDetails:function(){var t=n.CustomEntityAdministration.Forms;Spend_Management.svcCustomEntities.GetFieldDetails(s.AccountID,entityid,formid,t.GetFieldDetailsComplete,t.FormsWebServiceError)},GetFieldDetailsComplete:function(t){var i=n.CustomEntityAdministration.Forms;i.FormFieldDetails=t;i.SetAdditionalInformationInFormFieldDetails();i.GetAvailableFieldsForSelectionArea()},ShowTabModal:function(r,u){n.CustomEntityAdministration.Base.AssignDummyShortCuts();var f=n.CustomEntityAdministration.Forms;f.ClearTabModal();u!==undefined&&u===!0&&(f.EditTabMode=!1,f.EditTabObject=null);n.Common.ShowModal(modtabid);r!==null&&r!==undefined?(t("#lblTabModalTitle").html("Tab : "+r),i(txttabid).value=r):t("#lblTabModalTitle").html("New Tab");i(txttabid).select()},ClearTabModal:function(){validator=i(reqTabHeaderID);validator.isvalid=!0;c(validator);i(txttabid).value=""},AddTab:function(r,u){var f=n.CustomEntityAdministration.Forms,d,g,e,o,v,h,s,y,p,b,k,a,w;if(r=EscapeHTMLInString(r).replace(/</g,"").replace(/>/g,""),u){if(validateform("vgTabHeader")===!1)return;if(d=!0,f.EditTabObject!==null&&f.EditTabObject!==undefined&&f.EditTabObject!==""&&r===t("#"+f.EditTabObject.attr("id")).attr("tabname")&&(d=!1),d&&f.CheckTabNameExists(r)){n.MasterPopup.ShowMasterPopup("Cannot add a tab with this name as one already exists on this form.","Message from "+l);g=i(reqTabHeaderID);g.isvalid=!1;c(g);return}}if(f.EditTabMode){f.EditTab(r);return}for(e="Tab_"+f.NumberOfTabs,f.SelectedTab=e,o=document.createElement("span"),v=document.createElement("img"),v.setAttribute("id","tab_left_img_"+e),v.setAttribute("src","../images/backgrounds/tabs/tab_selected_left_img.png"),v.setAttribute("alt",""),o.appendChild(v),h=document.createElement("span"),h.setAttribute("id","tab_middle_img_"+e),h.setAttribute("class","sm_tabheader_middle"),h.setAttribute("className","sm_tabheader_middle"),o.appendChild(h),h.innerHTML+=r,s=document.createElement("img"),s.setAttribute("id","tab_options_img_"+e),s.setAttribute("src","../images/icons/16/Plain/gear.png"),s.setAttribute("alt","Options"),s.setAttribute("title","Options"),s.className="sm_form_editor_tab_btn",h.appendChild(s),s.onclick=function(){f.ShowFormOptions(this.id,f.ControlTypeObject.Tab,e,null)},y=document.createElement("img"),y.setAttribute("id","tab_right_img_"+e),y.setAttribute("src","../images/backgrounds/tabs/tab_selected_right_img.png"),y.setAttribute("alt",""),o.appendChild(y),o.setAttribute("class","sm_tabheader"),o.setAttribute("className","sm_tabheader"),o.setAttribute("tabname",r),o.id="tabbar_"+e,t(o).click(function(n){n.target.className!=="sm_form_editor_tab_btn"&&f.ChangeTab(e)}),document.getElementById("tabBar").appendChild(o),p=document.createElement("div"),p.id=e,p.style.overflow="auto",p.style.overflowX="hidden",document.getElementById("formTabs").appendChild(p),t("#tab_middle_img_"+e).addClass("selected_tab"),b=null,a=0;a<f.FormObj.tabs.length;a++)b=document.getElementById(f.FormObj.tabs[a].TabControlName),b!==null&&f.FormObj.tabs[a].TabControlName!==e&&(k=f.FormObj.tabs[a].TabControlName,b.style.display="none",document.getElementById("tab_left_img_"+k).src="../images/backgrounds/tabs/tab_left_img.png",t("#tab_middle_img_"+k).removeClass("selected_tab"),document.getElementById("tab_right_img_"+k).src="../images/backgrounds/tabs/tab_right_img.png");u&&(w=new f.TabObject,w.TabName=r,w.TabControlName=e,w.Order=f.FormObj.tabs.length,f.FormObj.tabs.push(w));t("#tabBar").sortable({opacity:.7,revert:200,placeholder:"placeholder-highlight",distance:15,helper:function(n,t){return t.clone()},start:function(n,t){t.placeholder.height(t.item.height()-4);t.placeholder.width(t.item.width()-4);t.helper.css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");t.helper.children().css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important")},stop:function(){t("#tabBar").removeClass("closedhand");t("#tabBar").children().removeClass("closedhand");t("#"+f.SelectedTab+" .sectionsortables").removeClass("closedhand")}});t("#tabBar").disableSelection();t("#tabbar_"+e).droppable({hoverClass:"drophover",accept:".customentityformsection",tolerance:"pointer",drop:function(n,i){t(".placeholder-highlight").css("display","none");f.MoveSectionToNewTab(i.draggable.attr("id"),i.draggable.parent().attr("id"),t(this).attr("id").replace("tabbar_",""))}});t("#"+e).sortable({opacity:.5,revert:200,axis:"y",placeholder:"placeholder-highlight",distance:15,helper:function(n,i){var r=i.clone();return r.children().each(function(n,i){t(i).attr("id","cloned_"+t(i).attr("id"))}),r},start:function(n,t){f.EditTabObject=null;t.placeholder.height(t.item.height()-4);t.placeholder.width(845);t.helper.css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");t.helper.children().css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important")},stop:function(){t("#"+f.SelectedTab).removeClass("closedhand");t("#"+f.SelectedTab).children().removeClass("closedhand");t("#"+f.SelectedTab+" .sectionsortables").removeClass("closedhand")}});t("#"+e).disableSelection();f.NumberOfTabs++;(f.EditTabObject===null||f.EditTabObject===undefined||f.EditTabObject==="")&&f.CreateNoTabsAndSectionsComments();u&&f.HideTabModal()},EditTab:function(i){var r=n.CustomEntityAdministration.Forms,f,o,u,e;for(i=EscapeHTMLInString(i).replace(/</g,"").replace(/>/g,""),f=r.EditTabObject.attr("id").replace("tabbar_",""),r.EditTabObject.attr("tabname",i),o=t("#tab_middle_img_"+f),o.text(i),u=document.createElement("img"),u.setAttribute("id","tab_options_img_"+f),u.setAttribute("src","../images/icons/16/Plain/gear.png"),u.setAttribute("alt","Options"),u.setAttribute("title","Options"),u.className="sm_form_editor_tab_btn",o.append(u),u.onclick=function(){r.ShowFormOptions(this.id,r.ControlTypeObject.Tab,f,null)},e=0;e<r.FormObj.tabs.length;e++)if(r.FormObj.tabs[e].TabControlName===f){r.FormObj.tabs[e].TabName=i;break}r.HideTabModal()},RemoveTab:function(i){var r=n.CustomEntityAdministration.Forms,u,f,e,o;confirm("Are you sure you want to delete this tab?")&&(t("#"+i+" .customentityformsection").each(function(n,i){t("#"+i.id+"_FieldsArea").children().each(function(n,i){var u=t(i).attr("id");u.indexOf("spacer")===-1?r.RemoveFormField(u,r.GetFieldByID(u)):r.RemoveFormField(u,r.SpacerField())})}),u=document.getElementById("tabbar_"+i),f=document.getElementById(i),r.SelectedTab===i&&(e=t("#tabbar_"+i).prev(),e.length>0?r.SelectedTab=e.attr("id").replace("tabbar_",""):(o=t("#tabbar_"+i).next(),r.SelectedTab=o.length>0?o.attr("id").replace("tabbar_",""):null)),u.parentNode.removeChild(u),f.parentNode.removeChild(f),r.RemoveTabInFormObj(i),r.CreateNoTabsAndSectionsComments(),r.SelectedTab!==null&&r.ChangeTab(r.SelectedTab))},GetTabByName:function(t){for(var r=n.CustomEntityAdministration.Forms,i=0;i<r.FormObj.tabs.length;i++)if(r.FormObj.tabs[i].TabControlName===t)return r.FormObj.tabs[i];return null},MoveSectionToNewTab:function(i,r,u){var e=n.CustomEntityAdministration.Forms,f,h,o,s,l,c;if(u!==r){for(f=new e.SectionObject,h=e.GetSectionByName(i),f.SectionControlName=u+"_Section_"+e.NumberOfSections,f.SectionName=h.SectionName,f.Fields=h.Fields,o=1;e.CheckSectionNameExists(f.SectionName,u);)f.SectionName=o>1?f.SectionName.substring(0,f.SectionName.length-3)+"["+o+"]":f.SectionName+" ["+o+"]",o++;for(s=[],t("#"+h.SectionControlName+"_FieldsArea > span").each(function(n,t){t.id.indexOf("spacer")===-1?s.push(e.GetFieldByID(t.id)):s.push(e.SpacerField(t.id))}),e.MoveSectionInFormObj(f,r,u),l=document.getElementById(i),l.parentNode.removeChild(l),e.RemoveSectionInFormObj(i),e.AddSection(f.SectionName,!1,u,f.SectionControlName),c=0;c<s.length;c++)e.NewField(f.SectionControlName+"_FieldsArea",s[c])}},GetAvailableFieldsForSelectionArea:function(){var t=n.CustomEntityAdministration.Forms,u=document.getElementById("availableFields"),i,r;if(u.innerHTML="",i=t.FormFieldDetails,t.FieldsUsedOnForm.length===t.FormFieldDetails.length)u.innerHTML="There are no remaining fields for this form.",u.style.paddingTop="10px";else for(i.sort(function(n,t){return n.SortDisplayName.toLowerCase()<t.SortDisplayName.toLowerCase()?-1:n.SortDisplayName.toLowerCase()>t.SortDisplayName.toLowerCase()?1:0}),r=0;r<i.length;r++)t.FieldsUsedOnForm.contains(i[r].AttributeID)===!1&&t.AddFieldToAvailableFields(i[r],null,!1);t.MakeAvailableFieldsDraggable();t.MakeAvailableFieldsDroppable()},SetAdditionalInformationInFormFieldDetails:function(){for(var f,i,t=n.CustomEntityAdministration.Forms,e,r,u=0;u<t.FormObj.tabs.length;u++)for(e=t.FormObj.tabs[u],f=0;f<e.Sections.length;f++)for(r=e.Sections[f].Fields,i=0;i<r.length;i++)t.FieldsUsedOnForm.push(r[i].AttributeID),t.UpdateFieldInFormFieldDetails(r[i],t.FormObj.tabs[u].TabControlName)},HideTabModal:function(){var t=n.CustomEntityAdministration.Forms;t.EditTabMode=!1;t.EditTabObject=null;n.Common.HideModal(modtabid);n.CustomEntityAdministration.Base.AddShortCuts("formDesigner")},CheckTabNameExists:function(t){for(var i=0;i<n.CustomEntityAdministration.Forms.FormObj.tabs.length;i++)if(n.CustomEntityAdministration.Forms.FormObj.tabs[i].TabName===t)return!0;return!1},CreateNoTabsAndSectionsComments:function(){n.CustomEntityAdministration.Forms.CreateNoTabsComments();n.CustomEntityAdministration.Forms.CreateNoSectionsComments()},CreateNoTabsComments:function(){if(!u("divnotab")){var t=document.createElement("div");t.className="onecolumnpanel";t.innerHTML='There are currently no tabs added to this form. Use the "New Tab" button above to create your first tab.';t.id="divnotab";i("formMsgs").appendChild(t)}i("divnotab").style.display=n.CustomEntityAdministration.Forms.FormObj.tabs.length==0?"":"none"},CreateNoSectionsComments:function(){var t=n.CustomEntityAdministration.Forms,r,f;if(u("divnosection")||(r=document.createElement("div"),r.className="onecolumnpanel",r.innerHTML='There are currently no sections added to this tab. Use the "New Section" icon in the options cog menu on the tab to create a section.',r.id="divnosection",i("formMsgs").appendChild(r)),t.FormObj.tabs.length!==0)if(t.SelectedTab!==null){for(f=0;f<t.FormObj.tabs.length;f++)if(t.FormObj.tabs[f].TabControlName===t.SelectedTab){i("divnosection").style.display=t.FormObj.tabs[f].Sections.length==0?"":"none";break}}else i("divnosection").style.display="none";else i("divnosection").style.display="none"},ShowFormOptions:function(i,r,u,f){var c=n.CustomEntityAdministration.Forms,e,s,h,o;r===c.ControlTypeObject.Field?(h=t("#"+i),h.is(":animated")===!1&&(e=h.children(".sm_form_field_options").first(),s=e.children(".sm_btn"),e.stop(!0,!0),e.css("zIndex",n.CustomEntityAdministration.zIndices.Forms.ContextMenu()),e.css("top","0px"),s.unbind("mouseenter").unbind("mouseleave").unbind("click"),s.mouseenter(function(){t(this).addClass("field_options_image_hover")}).mouseleave(function(){t(this).removeClass("field_options_image_hover")}).click(function(){t(this).removeClass("field_options_image_hover")}),e.fadeIn(250))):(e=t("#"+popupFormOptionsID),o=t("#"+i),e.html(""),c.CreateOptionsMenu(r,u,f),s=e.children(".sm_btn"),t("#maindiv").append(e),e.stop(!0,!0),e.css("filter",""),e.css("display",""),o.offset().left+e.outerWidth()>=t(window).width()?e.css("left",o.offset().left-e.outerWidth()):e.css("left",o.offset().left+o.outerWidth()),e.css("top",o.offset().top+o.outerHeight()),e.css("right","auto"),e.css("zIndex",n.CustomEntityAdministration.zIndices.Forms.ContextMenu()),e.css("position","absolute"),e.fadeIn(250),s.unbind("mouseenter").unbind("mouseleave").unbind("click"),s.mouseenter(function(){t(this).addClass("field_options_image_hover")}).mouseleave(function(){t(this).removeClass("field_options_image_hover")}).click(function(){t(this).removeClass("field_options_image_hover")}))},HideFormOptions:function(n){var i;i=n===undefined?t("#"+popupFormOptionsID):t("#"+n);i.fadeOut(200);return},MakeSectionFieldsSortable:function(){var r=n.CustomEntityAdministration.Forms;t("#"+r.SelectedTab+" .sectionsortables").sortable({opacity:.7,revert:200,connectWith:"#"+r.SelectedTab+" .sectionsortables",zIndex:n.CustomEntityAdministration.zIndices.Forms.AvailableFields(),placeholder:"placeholder-highlight-fields",distance:15,start:function(n,i){i.helper.css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");i.helper.children().css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");r.SortEventCancelled=!1;t("#dialog").addClass("ui-state-disabled").attr("id","dialogDisabled");t("#temporaryPlaceholder").removeClass("placeholder-highlight-fields");r.CurrentlyDragging=!0;t("#"+i.item.attr("id")+"_optionsmenu").css("display","none");i.item.unbind("mouseenter");i.item.unbind("mouseleave");i.item.attr("class").indexOf("sm_field_spacer")!==-1?(i.placeholder.height(28),i.placeholder.width(402)):(i.placeholder.width(i.item.width()-8),i.placeholder.height(i.item.height()-8));i.helper.height(i.item.height());i.helper.width(i.item.width())},stop:function(n,u){var h,e,o,a,c;if(r.CurrentlyDragging=!1,r.SortEventCancelled===!1){if(u.item.attr("id")===undefined)if(u.item.text()==="Spacer")e=t("#form_attribute_spacer_0").clone(!0),o="form_attribute_spacer_"+r.NumberOfSpacers,e.attr("id",o),u.item.replaceWith(e),h=r.CreateOptionsMenu(r.ControlTypeObject.Field,o,r.SpacerField(r.NumberOfSpacers)),e.append(h),e.unbind("mouseenter"),e.unbind("mouseleave"),e.mouseenter(function(){r.CurrentlyDragging===!1&&(t("#"+r.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none"),r.selectedControl=i(o),r.ShowFormOptions(o,r.ControlTypeObject.Field,o,r.SpacerField()))}).mouseleave(function(){r.HideFormOptions(o+"_optionsmenu")}),r.NumberOfSpacers++;else{var f=u.item.attr("fieldid").replace("cloned_",""),v=u.item.attr("availablefieldid"),s=t("#"+f),y=t("#availableFields [availablefieldid='"+v+"']"),l=r.GetFieldByID(f);s.attr("id",f);u.item.replaceWith(s);a=i("availableFields");a.removeChild(y[0]);t("#availableFields").children().length===0&&(t("#availableFields").html("There are no remaining fields for this form."),t("#availableFields").css("paddingTop","10px"));t("#"+f+"_optionsmenu").html("");t("#"+f+"_optionsmenu").remove();h=r.CreateOptionsMenu(r.ControlTypeObject.Field,f,l);s.append(h);s.unbind("mouseenter");s.unbind("mouseleave");s.mouseenter(function(){r.CurrentlyDragging===!1&&(t("#"+r.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none"),r.selectedControl=i(f),r.ShowFormOptions(f,r.ControlTypeObject.Field,f,l))}).mouseleave(function(){r.HideFormOptions(f+"_optionsmenu")})}else c=u.item.attr("id"),t("#"+r.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none"),u.item.unbind("mouseenter").unbind("mouseleave"),u.item.mouseenter(function(){r.CurrentlyDragging===!1&&(t("#"+r.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none"),r.selectedControl=u.item,r.ShowFormOptions(c,r.ControlTypeObject.Field,c,null))}).mouseleave(function(){r.HideFormOptions(c+"_optionsmenu")});t("#dialogDisabled").removeClass("ui-state-disabled").attr("id","dialog");t("#"+r.SelectedTab+" .sectionsortables").removeClass("closedhand");t("#"+r.SelectedTab+" .sectionsortables").children().removeClass("closedhand");t("#availableFields > span").removeClass("closedhand");t("#availableFields > span").children().removeClass("closedhand");t("#temporaryPlaceholder").remove()}},receive:function(n,t){if(r.SortEventCancelled===!1){var i;i=t.item.attr("availablefieldid")?t.item.attr("availablefieldid").replace("availableField","form_attribute_"):"spacer";i.indexOf("spacer")===-1&&r.MoveFieldToNewSection(r.GetFieldByID(i),t.sender.attr("id"),n.target.id)}},beforeStop:function(n,i){t(i.placeholder).position().top===0&&t(i.placeholder).position().left===0&&(r.SortEventCancelled=!0)},helper:function(n,i){var r=document.getElementById(i.attr("id")).cloneNode(!0),u;return t(r).find("textarea").val(t("#"+i.attr("id")+" textarea").val()),r.id="cloned_"+r.id,u=document.getElementById("dragFieldHolder"),u.appendChild(r),r}});t("#"+r.SelectedTab+" .sectionsortables").disableSelection()},MakeSpacerFieldDraggable:function(){var i=n.CustomEntityAdministration.Forms;t("#sm_field_spacer").draggable({opacity:.7,connectToSortable:"#"+i.SelectedTab+" .sectionsortables",zIndex:n.CustomEntityAdministration.zIndices.Forms.AvailableFields(),revert:200,helper:function(){var t=document.getElementById("form_attribute_spacer_0").cloneNode(!0),i;return t.id="cloned_"+t.id,t.style.zIndex=n.CustomEntityAdministration.zIndices.Forms.AvailableFields(),i=document.getElementById("dragFieldHolder"),i.appendChild(t),t},stop:function(n,r){t(".placeholder-highlight-fields").length===0&&(i.SortEventCancelled=!0,t("#dialogDisabled").removeClass("ui-state-disabled").attr("id","dialog"),t("#sm_field_spacer").removeClass("closedhand"),t("#sm_field_spacer").children().removeClass("closedhand"),t("#"+i.SelectedTab+" .sectionsortables").removeClass("closedhand"),t("#temporaryPlaceholder").remove(),t(r.helper).remove());i.CurrentlyDragging=!1},start:function(n,r){r.helper.css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");r.helper.children().css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");i.SortEventCancelled=!1;t("#dialog").addClass("ui-state-disabled").attr("id","dialogDisabled");i.CurrentlyDragging=!0}})},MakeAvailableFieldsDraggable:function(i){var r=n.CustomEntityAdministration.Forms;i===undefined&&(i="#availableFields > span");t(i).draggable({opacity:.7,connectToSortable:"#"+r.SelectedTab+" .sectionsortables",cancel:"#dialogDisabled",zIndex:n.CustomEntityAdministration.zIndices.Forms.AvailableFields(),revert:200,helper:function(){var r=t(this).attr("fieldid"),i=t("#"+r).clone();return i.find("textarea").val(t("#"+r+" textarea").val()),i.attr("id","cloned_"+r),i.attr("availablefieldid","invalid"),i.css("zIndex",n.CustomEntityAdministration.zIndices.Forms.AvailableFields()),t("#dragFieldHolder").append(i),i},stop:function(n,u){t(".placeholder-highlight-fields").length===0&&(r.SortEventCancelled=!0,t("#dialogDisabled").removeClass("ui-state-disabled").attr("id","dialog"),t(i).removeClass("closedhand"),t(i).children().removeClass("closedhand"),t("#"+r.SelectedTab+" .sectionsortables").removeClass("closedhand"),t("#temporaryPlaceholder").remove(),t(u.helper).remove());r.CurrentlyDragging=!1},start:function(n,i){i.helper.css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");i.helper.children().css("cursor","url("+StaticLibPath+"/cursors/closedhand.cur), default !important");r.SortEventCancelled=!1;t("#dialog").addClass("ui-state-disabled").attr("id","dialogDisabled");r.CurrentlyDragging=!0;t("#"+r.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none")}});t("#"+r.SelectedTab+" .sectionsortables").disableSelection();t("#tabBar").disableSelection()},MakeAvailableFieldsDroppable:function(){var i=n.CustomEntityAdministration.Forms;t("#dialog").droppable({accept:"#"+i.SelectedTab+' span[id^="form_attribute_"]',tolerance:"pointer",hoverClass:"availablefieldhover",drop:function(n,r){r.draggable.attr("id").indexOf("spacer")===-1?t(i.FormFieldDetails).each(function(n,u){if(u.AttributeID.toString()===r.draggable.attr("id").replace("form_attribute_",""))return t(".placeholder-highlight-fields").css("display","none"),i.RemoveFormField(u.ControlName,u,r.helper),!1}):(t(".placeholder-highlight-fields").css("display","none"),i.RemoveFormField(r.draggable.attr("id"),i.SpacerField(),r.helper))},over:function(){t("#dialogDisabled").removeClass("ui-state-disabled").attr("id","dialog")},out:function(){t("#dialog").addClass("ui-state-disabled").attr("id","dialogDisabled")}})},NewField:function(i,r){var f=n.CustomEntityAdministration.Forms,l=f.SetFieldType(r.FieldType),k=l.fieldTag,d=r.DisplayName.toString().replace(/\s/g,"").toLowerCase(),s,o,h,u,a,c,v,w,g,b,nt,y,p,e,tt,it,rt,ut,ft;if(s=r.LabelText?EscapeHTMLInString(r.LabelText):EscapeHTMLInString(r.DisplayName.toString()),s.length>30&&(s=s.substring(0,30)+"..."),u=document.createElement("span"),u.setAttribute("id","sm_field__"+d),u.className=l.className,u.setAttribute("fielddisplayname",r.DisplayName),u.id="form_attribute_"+r.AttributeID,r.ColumnSpan=l.columnSpan,r.FieldType===f.FieldTypeEnum.OTMSummary.intVal||r.FieldType===f.FieldTypeEnum.Relationship.intVal&&r.RelationshipType===f.RelationshipType.OneToMany){for(u.className="sm_field_grid",r.ColumnSpan=2,a=function(n,t,i){return{alt:n,src:t,text:i}},c=[new a("Edit","/shared/images/icons/edit_blue.gif","")],c.push(new a("Delete","/shared/images/icons/delete2_blue.gif","")),c.push(new a("View","/shared/images/icons/view.png","")),c.push(new a("Arrow","/shared/images/whitearrow_up.gif",l.attributeName+" Column 1 ")),o=2;o<6;o++)c.push(new a("","",l.attributeName+" Column "+o));for(v=document.createElement("table"),v.className="cGrid",v.setAttribute("id","sm_table__"+d),v.setAttribute("width","800"),w=document.createElement("tbody"),g=document.createElement("tr"),o=0;o<c.length;o++)h=document.createElement("th"),c[o].src==""?h.innerHTML=c[o].text:(b=document.createElement("img"),b.setAttribute("alt",c[o].alt),b.setAttribute("src",c[o].src),h.innerHTML=c[o].text+" ",h.appendChild(b)),g.appendChild(h);w.appendChild(g);nt=document.createElement("tr");h=document.createElement("td");h.className="row1";h.colSpan="8";h.align="center";h.innerHTML=s+" information will be displayed here.";nt.appendChild(h);w.appendChild(nt);v.appendChild(w);u.appendChild(v)}else if(r.FieldType===f.FieldTypeEnum.Comment.intVal)u.innerHTML=s+" - Note that the size of this comment block will increase as the amount of text increases.";else if(r.FieldType===f.FieldTypeEnum.Spacer.intVal)u.id="form_attribute_spacer_"+r.AttributeID,u.innerHTML=r.DisplayName;else{switch(r.Format){case f.Format.MultiLine:r.FieldType===f.FieldTypeEnum.Text.intVal&&(k="textarea",t(u).attr("class","sm_field_tall onecolumn"),r.ColumnSpan=2);break;case f.Format.FormattedText:k="span";break;case f.Format.SingleLineWide:t(u).removeClass("sm_field").addClass("sm_field_wide");r.ColumnSpan=2;break;case f.Format.ListWide:t(u).removeClass("sm_field").addClass("sm_field_wide");r.ColumnSpan=2}y=document.createElement("label");r.Mandatory&&(y.className="mandatory");y.setAttribute("id","lbl_"+r.AttributeID);r.Mandatory&&(s=s+"*");r.ReadOnly&&(s=s+" (Read only)");y.innerHTML=s;p=document.createElement("span");p.className="sm_input";e=document.createElement(k);e.setAttribute("id",l.idPrefix+d);e.setAttribute("readonly",!0);switch(r.FieldType){case f.FieldTypeEnum.Text.intVal:case f.FieldTypeEnum.TextWide.intVal:e.value=r.DefaultValue?r.DefaultValue:"";break;case f.FieldTypeEnum.Number.intVal:e.setAttribute("type",l.inputType);e.setAttribute("maxlength","250");break;case f.FieldTypeEnum.List.intVal:e.options[e.length]=new Option("List Items","0");break;case f.FieldTypeEnum.LargeText.intVal:r.Format===6?(e.className="richTextBox",e.innerHTML=r.DefaultValue?r.DefaultValue:""):(e.setAttribute("cols","100"),e.setAttribute("rows","3"),e.value=r.DefaultValue?r.DefaultValue:"");break;case f.FieldTypeEnum.TickBox.intVal:e.options[e.length]=new Option("Yes","0");e.options[e.length]=new Option("No","1");break;case f.FieldTypeEnum.LookupDisplayField.intVal:e.innerHTML="&nbsp;"+r.FieldValue;e.title=r.FieldValue;p.className="ellide sm_input";break;case f.FieldTypeEnum.Attachment.intVal:e.setAttribute("type",l.inputType);e.setAttribute("style","width: 80px;");e.value="browse ..."}tt=document.createElement("span");tt.className="sm_icon";it=document.createElement("span");it.className="sm_tooltip";rt=document.createElement("span");rt.className="sm_validators";u.appendChild(y);p.appendChild(e);u.appendChild(p);u.appendChild(tt);u.appendChild(it);u.appendChild(rt)}return ut=f.CreateOptionsMenu(f.ControlTypeObject.Field,u.id,r),u.appendChild(ut),t(u).mouseenter(function(){f.CurrentlyDragging===!1&&(t("#"+f.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none"),f.selectedControl=u,f.ShowFormOptions(u.id,f.ControlTypeObject.Field,r.ControlName,r))}).mouseleave(function(){f.HideFormOptions(u.id+"_optionsmenu")}),u.setAttribute("fieldclass",u.className),ft=document.getElementById(i),ft.appendChild(u),u.className},SaveForm:function(){var e=n.CustomEntityAdministration.Misc,r=n.CustomEntityAdministration.Forms;if(validateform("vgFormEdit")!==!1){e.LoadingScreenCancelled=!1;setTimeout(function(){e.ShowInformationMessage("Saving...")},450);var o=i(txtformsavebuttontextid).value,h=i(txtformsaveandduplicatebuttontextid).value,c=i(txtformsaveandstaybuttontextid).value,l=i(txtformsaveandnewbuttontextid).value,a=i(txtformcancelbuttontextid).value,u=new r.TabObject,f=new r.SectionObject;r.FormObj.formName=document.getElementById(txtformnameid).value;r.FormObj.description=document.getElementById(txtformdescriptionid).value;r.FormObj.showSave=o==""?!1:!0;r.FormObj.saveButtonText=o;r.FormObj.showSaveAndDuplicate=h==""?!1:!0;r.FormObj.saveAndDuplicateButtonText=h;r.FormObj.showSaveAndStay=c==""?!1:!0;r.FormObj.showSaveAndNew=l==""?!1:!0;r.FormObj.saveAndStayButtonText=c;r.FormObj.saveAndNewButtonText=l;r.FormObj.showCancel=a==""?!1:!0;r.FormObj.cancelButtonText=a;r.FormObj.showSubMenus=t("#"+chkshowsubmenuid).is("checked");r.FormObj.showBreadcrumbs=t("#"+chkshowbreadcrumbsid).is(":checked");r.FormObj.hideTorch=t("#"+chkHideTorch).is(":checked");r.FormObj.hideAttachments=t("#"+chkHideAttachments).is(":checked");r.FormObj.hideAudiences=t("#"+chkHideAudiences).is(":checked");r.FormObj.tabs=[];t("#tabBar .sm_tabheader").each(function(n,i){u=new r.TabObject;u.Order=n;u.TabControlName=i.id;u.TabName=EscapeHTMLInString(t(i).attr("tabname"));t("#"+i.id.replace("tabbar_","")+" .customentityformsection").each(function(n,i){f=new r.SectionObject;f.Order=n;f.SectionControlName=i.id;f.SectionName=t(i).attr("sectionname");f.Fields=r.SortFormFieldOrder(i.id);u.Sections.push(f)});r.FormObj.tabs.push(u)});Spend_Management.svcCustomEntities.saveForm(s.AccountID,employeeid,entityid,r.CurrentFormID,r.FormObj,r.SaveFormComplete,r.FormsWebServiceError)}},SaveFormComplete:function(i){var u=n.CustomEntityAdministration.Misc,r;if(i==-1){u.LoadingScreenCancelled=!0;t("#loadingArea").remove();n.MasterPopup.ShowMasterPopup("The Form name you have entered already exists.","Message from "+l);return}r=n.CustomEntityAdministration.Forms;r.HideFormModal();t("#dialog").dialog("close");Spend_Management.svcCustomEntities.getFormGrid(entityid,r.RefreshFormGridComplete);u.LoadingScreenCancelled=!0;t("#loadingArea").fadeOut(600,function(){t("#loadingArea").remove()});return},RefreshFormGridComplete:function(t){u(pnlFormID)===!0&&(i(pnlFormID).innerHTML=t[1],n.Grid.updateGrid(t[0]));return},ResetFormButtonTextLabels:function(){var n=i(lblsavebuttontextid),t=i(lblsaveandduplicatebuttontextid),r=i(lblsaveandstaybuttontextid),u=i(lblsaveandnewbuttontextid),f=i(lblcancelbuttontextid);n.className="mandatory";t.className="mandatory";r.className="mandatory";u.className="mandatory";f.className="mandatory";n.innerHTML.indexOf("*")<=0&&(n.innerHTML=n.innerHTML+"*",t.innerHTML=t.innerHTML+"*",r.innerHTML=r.innerHTML+"*",u.innerHTML=u.innerHTML+"*",f.innerHTML=f.innerHTML+"*")},DeleteForm:function(t){if(confirm("Are you sure you wish to delete the selected form?")){var i=n.CustomEntityAdministration.Forms;Spend_Management.svcCustomEntities.deleteForm(t,i.DeleteFormComplete,i.FormsWebServiceError)}},DeleteFormComplete:function(t){t===0?Spend_Management.svcCustomEntities.getFormGrid(entityid,n.CustomEntityAdministration.Forms.RefreshFormGridComplete):t===-2?n.MasterPopup.ShowMasterPopup("This form cannot be deleted as it is presently in use by a form selection mapping.","Message from "+l):n.MasterPopup.ShowMasterPopup("This form cannot be deleted as it is presently in use by a view.","Message from "+l);return},SortFormFieldOrder:function(i){var e=n.CustomEntityAdministration.Forms,u=0,f=0,r,o=[];return t("#"+i+"_FieldsArea > span").each(function(n,t){r=t.id.indexOf("spacer")===-1?e.GetFieldByID(t.id):e.SpacerField();r.ColumnSpan===1?u===0?(r.Column=u,r.Row=f,u=1):(r.Column=u,r.Row=f,u=0,f++):(u===1&&(f++,u=0),r.Column=u,r.Row=f,f++);t.id.indexOf("spacer")===-1&&o.push(r)}),o},ChangeTab:function(i){for(var r=n.CustomEntityAdministration.Forms,u,f=0;f<r.FormObj.tabs.length;f++)u=r.FormObj.tabs[f].TabControlName,document.getElementById(r.FormObj.tabs[f].TabControlName).style.display="none",document.getElementById("tab_left_img_"+u).src="../images/backgrounds/tabs/tab_left_img.png",t("#tab_middle_img_"+u).removeClass("selected_tab"),document.getElementById("tab_right_img_"+u).src="../images/backgrounds/tabs/tab_right_img.png";document.getElementById(i).style.display="";document.getElementById("tab_left_img_"+i).src="../images/backgrounds/tabs/tab_selected_left_img.png";t("#tab_middle_img_"+i).addClass("selected_tab");document.getElementById("tab_right_img_"+i).src="../images/backgrounds/tabs/tab_selected_right_img.png";r.SelectedTab=i;r.CreateNoTabsAndSectionsComments();r.MakeSectionFieldsSortable();r.MakeAvailableFieldsDraggable();r.MakeSpacerFieldDraggable();r.MakeAvailableFieldsDroppable();t("#"+r.SelectedTab+" .sectionsortables").bind("mousedown",function(){t(this).addClass("closedhand")});t("#"+r.SelectedTab).bind("mousedown",function(){t("#"+r.SelectedTab).addClass("closedhand")})},SaveTabWithModalSave:function(){n.CustomEntityAdministration.Forms.AddTab(i(txtTabHeaderID).value,!0)},UpdateSectionInFormObj:function(t,i){var u=n.CustomEntityAdministration.Forms,r,f;for(i===undefined&&(i=u.SelectedTab),r=0;r<u.FormObj.tabs.length;r++)if(u.FormObj.tabs[r].TabControlName===i)for(f=0;f<u.FormObj.tabs[r].Sections.length;f++)if(u.FormObj.tabs[r].Sections[f].SectionControlName===t.SectionControlName){u.FormObj.tabs[r].Sections[f]=t;return}return},MoveSectionInFormObj:function(t,i,r){for(var e,f=n.CustomEntityAdministration.Forms,u=0;u<f.FormObj.tabs.length;u++){if(f.FormObj.tabs[u].TabControlName===i)for(e=0;e<f.FormObj.tabs[u].Sections.length;e++)f.FormObj.tabs[u].Sections[e].SectionControlName===t.SectionControlName&&f.FormObj.tabs[u].Sections.splice(e,1);f.FormObj.tabs[u].TabControlName===r&&f.FormObj.tabs[u].Sections.push(t)}return},RemoveSectionInFormObj:function(t){for(var u,i=n.CustomEntityAdministration.Forms,f=!1,r=0;r<i.FormObj.tabs.length;r++)if(i.FormObj.tabs[r].TabControlName===i.SelectedTab){for(u=0;u<i.FormObj.tabs[r].Sections.length;u++)f==!1&&i.FormObj.tabs[r].Sections[u].SectionControlName===t.replace("_section","")&&(i.FormObj.tabs[r].Sections.splice(u,1),f=!0),f&&u<i.FormObj.tabs[r].Sections.length&&(i.FormObj.tabs[r].Sections[u].Order=i.FormObj.tabs[r].Sections[u].Order-1);if(f)break}return},RemoveSection:function(i){var r=n.CustomEntityAdministration.Forms,u;confirm("Are you sure you want to delete this section?")&&(t("#"+i+"_FieldsArea").children().each(function(n,i){var u=t(i).attr("id");u.indexOf("spacer")===-1?r.RemoveFormField(u,r.GetFieldByID(u)):r.RemoveFormField(u,r.SpacerField())}),u=document.getElementById(i),u.parentNode.removeChild(u),r.RemoveSectionInFormObj(i),r.SelectedSection===i&&(r.SelectedSection=null),r.CreateNoTabsAndSectionsComments())},RemoveFormField:function(i,r,u){var f=n.CustomEntityAdministration.Forms;if(r.FieldType===f.FieldTypeEnum.Spacer.intVal)t("#"+i).remove(),u!==undefined&&u.remove();else{t("#availableFields").html()==="There are no remaining fields for this form."&&t("#availableFields").html("");var e=t("#"+i),s=e.parent().attr("id"),o=e.clone(!0);o.find("textarea").val(e.find("textarea").val());o.css("display","");f.AddFieldToAvailableFields(r,t(o).attr("fieldclass"),!0);e.remove();u!==undefined&&u.remove();t("#availableFieldDoms").append(o);f.MoveFieldToNewSection(r,s,"");f.MakeAvailableFieldsDraggable("#availableField"+r.AttributeID);f.EditLabelField=r;f.ResetFieldLabel()}return},GetSectionByName:function(t,i){var u=n.CustomEntityAdministration.Forms,r,f;for(i===undefined&&(i=u.SelectedTab),r=0;r<u.FormObj.tabs.length;r++)if(u.FormObj.tabs[r].TabControlName===i)for(f=0;f<u.FormObj.tabs[r].Sections.length;f++)if(u.FormObj.tabs[r].Sections[f].SectionControlName===t)return u.FormObj.tabs[r].Sections[f];return null},RemoveSpacerField:function(t,i){var r=n.CustomEntityAdministration.Forms;i!==undefined&&i.remove();r.MoveFieldToNewSection(t,"","");r.MakeAvailableFieldsDraggable("#availableField"+t.AttributeID);r.EditLabelField=t;r.ResetFieldLabel();return},GetFieldByID:function(i){var r=null;return t(n.CustomEntityAdministration.Forms.FormFieldDetails).each(function(n,t){if(t.ControlName.toString()===i.toString())return r=t,!1}),r},RemoveFieldInFormObj:function(t){for(var u,f,i=n.CustomEntityAdministration.Forms,r=0;r<i.FormObj.tabs.length;r++)if(i.FormObj.tabs[r].TabControlName===i.SelectedTab)for(u=0;u<i.FormObj.tabs[r].Sections.length;u++)for(f=0;f<i.FormObj.tabs[r].Sections[u].Fields.length;f++)if(i.FormObj.tabs[r].Sections[u].Fields[f].ControlName===t){i.FormObj.tabs[r].Sections[u].Fields.splice(f,1);return}return null},UpdateFieldInFormFieldDetails:function(i,r){var u=n.CustomEntityAdministration.Forms,f,e,o;for(r===undefined&&(r=u.SelectedTab),f=0;f<u.FormObj.tabs.length;f++)if(u.FormObj.tabs[f].TabControlName===r)for(e=0;e<u.FormObj.tabs[f].Sections.length;e++)for(o=0;o<u.FormObj.tabs[f].Sections[e].Fields.length;o++)if(u.FormObj.tabs[f].Sections[e].Fields[o].ControlName===i.ControlName){u.FormObj.tabs[f].Sections[e].Fields[o]=i;t(u.FormFieldDetails).each(function(n,t){if(t.ControlName===i.ControlName)return u.FormFieldDetails[n]=i,!1});return}return},SetFieldToReadOnly:function(t){var u=n.CustomEntityAdministration.Forms,i=u.GetFieldByID(u.selectedControl.id),r;r=i.LabelText?EscapeHTMLInString(i.LabelText):EscapeHTMLInString(i.DisplayName.toString());r.length>30&&(r=r.substring(0,30)+"...");i.Mandatory&&(r=r+"*");i.ReadOnly?(i.ReadOnly=!1,t.innerHTML=r):(i.ReadOnly=!0,t.innerHTML=r+" (Read only)");u.UpdateFieldInFormFieldDetails(i)},MoveFieldInFormObj:function(t,i){for(var f,e,r=n.CustomEntityAdministration.Forms,u=0;u<r.FormObj.tabs.length;u++)if(r.FormObj.tabs[u].TabControlName===r.SelectedTab)for(f=0;f<r.FormObj.tabs[u].Sections.length;f++)for(e=0;e<r.FormObj.tabs[u].Sections[f].Fields.length;e++)if(r.FormObj.tabs[u].Sections[f].Fields[e].ControlName===t){i?(r.FormObj.tabs[u].Sections[f].Fields.splice(e-1,0,r.FormObj.tabs[u].Sections[f].Fields[e]),r.FormObj.tabs[u].Sections[f].Fields.splice(e+1,1)):(r.FormObj.tabs[u].Sections[f].Fields.splice(e+2,0,r.FormObj.tabs[u].Sections[f].Fields[e]),r.FormObj.tabs[u].Sections[f].Fields.splice(e,1));return}return},UpdateFieldLabel:function(){var i=n.CustomEntityAdministration.Forms,r,u,f;if(validateform("vgLabel")!=!1){i.EditLabelField!==undefined&&(r=EscapeHTMLInString(t("#"+txtfieldlabelID).val()),i.EditLabelField.LabelText=r,u=t("#lbl_"+i.EditLabelField.AttributeID),r.length>30?u.html(r.substring(0,30)+"..."):u.html(r),i.EditLabelField.Mandatory&&u.append("*"),i.EditLabelField.ReadOnly&&u.append(" (Read only)"),f=i.CreateOptionsMenu(i.ControlTypeObject.Field,i.EditLabelField.ControlName,i.EditLabelField),t("#"+i.EditLabelField.ControlName).append(f),i.UpdateFieldInFormFieldDetails(i.EditLabelField),i.EditLabelField="",i.HideFieldLabelModal());return}},UpdateDefaultText:function(){var e=n.CustomEntityAdministration.Forms,u=t("#defaultTextFieldContainer .active"),i=u.data("field"),o,f;i&&(i.Format===6?u.get(0)&&(o=r(n.CustomEntityAdministration.DomIDs.Forms.EditorExtender),i.DefaultValue=o._editableDiv.innerHTML,t("#form_attribute_"+i.AttributeID).find(".richTextBox").html(i.DefaultValue)):(f="textarea",i.FieldType===10?i.DefaultValue=u.val():(i.Format!==2&&(f="input"),i.DefaultValue=u.val()),t("#form_attribute_"+i.AttributeID).find(f).val(i.DefaultValue)),e.UpdateFieldInFormFieldDetails(i));e.HideDefaultTextModal()},ResetFieldLabel:function(){var i=n.CustomEntityAdministration.Forms,u,r,f;i.EditLabelField!==undefined&&(u=EscapeHTMLInString(i.EditLabelField.DisplayName),r=t("#lbl_"+i.EditLabelField.AttributeID),i.EditLabelField.LabelText=null,u.length>30?r.html(u.substring(0,30)+"..."):r.html(u),i.EditLabelField.Mandatory&&r.append("*"),i.EditLabelField.ReadOnly&&r.append(" (Read only)"),f=i.CreateOptionsMenu(i.ControlTypeObject.Field,i.EditLabelField.ControlName,i.EditLabelField),t("#"+i.EditLabelField.ControlName).append(f),i.UpdateFieldInFormFieldDetails(i.EditLabelField),i.EditLabelField="")},MakeFormModalDroppable:function(){var r=n.CustomEntityAdministration.Forms;t("#formDesignContents").droppable({accept:"#sm_field_spacer, #availableFields .ui-draggable",over:function(n,i){var u,f,e,o;r.SelectedTab!==null&&(u=t("#"+r.SelectedTab+" .sectionsortables").last(),u.length>0&&(i.helper.attr("class").indexOf("sm_field_spacer")===-1?(e=i.helper.width()-8,f=i.helper.height()-8):(f=28,e=402),o=t("<span />").addClass("placeholder-highlight-fields").height(f).width(e).attr("id","temporaryPlaceholder"),u.append(o)))},out:function(){t("#temporaryPlaceholder").remove()},drop:function(u,f){var c,l,a,e,v,o,h;if(t("#dialog").addClass("ui-state-disabled").attr("id","dialogDisabled"),t(".placeholder-highlight-fields").length>0&&r.SelectedTab!==null&&(v=t("#"+r.SelectedTab+" .sectionsortables").last(),v.length>0))if(f.draggable.attr("id").indexOf("spacer")===-1&&(e="",e=f.draggable.attr("id").indexOf("availableField")!=-1?f.draggable.attr("id").replace("availableField","form_attribute_"):f.draggable.attr("id"),r.MoveFieldToNewSection(r.GetFieldByID(e),null,t("#"+r.SelectedTab+" .sectionsortables").last().attr("id").replace("_FieldsArea",""))),f.draggable.text()==="Spacer")o=t("#form_attribute_spacer_0").clone(!0),h="form_attribute_spacer_"+r.NumberOfSpacers,o.attr("id",h),c=t("#temporaryPlaceholder").offset(),l=f.helper.offset(),a=t("#dragFieldHolder"),a.append(o),o.css("position","absolute").css("top",l.top).css("left",l.left),o.css("zIndex",n.CustomEntityAdministration.zIndices.Forms.Fields()),o.animate({top:c.top,left:c.left},"200",function(){o.css("position","relative").css("top","").css("left","");v.append(o);var n=r.CreateOptionsMenu(r.ControlTypeObject.Field,h,r.SpacerField(r.NumberOfSpacers));t(n).css("display","none");o.append(n);o.unbind("mouseenter");o.unbind("mouseleave");o.mouseenter(function(){r.CurrentlyDragging===!1&&(t("#"+r.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none"),r.selectedControl=i(h),r.ShowFormOptions(h,r.ControlTypeObject.Field,h,r.SpacerField()))}).mouseleave(function(){r.HideFormOptions(h+"_optionsmenu")});r.NumberOfSpacers++;r.CurrentlyDragging=!1;t("#dialogDisabled").removeClass("ui-state-disabled").attr("id","dialog");t("#temporaryPlaceholder").remove()});else{e=f.draggable.attr("fieldid");var p=f.draggable.attr("availablefieldid"),s=t("#"+e),w=i(p),y=r.GetFieldByID(e);c=t("#temporaryPlaceholder").offset();l=f.helper.offset();a=t("#dragFieldHolder");a.append(s);s.css("position","absolute").css("top",l.top).css("left",l.left);s.css("zIndex",n.CustomEntityAdministration.zIndices.Forms.Fields());s.animate({top:c.top,left:c.left},"200",function(){var n,u;s.css("position","relative").css("top","").css("left","");v.append(s);n=i("availableFields");n.removeChild(w);t("#availableFields").children().length===0&&(t("#availableFields").html("There are no remaining fields for this form."),t("#availableFields").css("paddingTop","10px"));t("#"+e+"_optionsmenu").html("");t("#"+e+"_optionsmenu").remove();u=r.CreateOptionsMenu(r.ControlTypeObject.Field,e,y);s.append(u);s.unbind("mouseenter");s.unbind("mouseleave");s.mouseenter(function(){r.CurrentlyDragging===!1&&(t("#"+r.SelectedTab+" .sm_form_field_options, #"+popupFormOptionsID).css("display","none"),r.selectedControl=i(e),r.ShowFormOptions(e,r.ControlTypeObject.Field,e,y))}).mouseleave(function(){r.HideFormOptions(e+"_optionsmenu")});r.CurrentlyDragging=!1;t("#dialogDisabled").removeClass("ui-state-disabled").attr("id","dialog");t("#temporaryPlaceholder").remove()})}}})},AddFieldToAvailableFields:function(i,r,u){var c=document.getElementById("availableFields"),f,e,h,s,o;(r===undefined||r===null)&&(r=n.CustomEntityAdministration.Forms.NewField("availableFieldDoms",i));f=document.createElement("span");f.id="availableField"+i.AttributeID;f.className=r;f.setAttribute("fieldid","form_attribute_"+i.AttributeID);f.setAttribute("availablefieldid","availableField"+i.AttributeID);f.setAttribute("fieldclass",r);e=document.createElement("img");e.setAttribute("id","lookupfield_"+i.AttributeID);e.setAttribute("src",StaticLibPath+"/icons/16/plain/link.png");e.setAttribute("alt","");e.setAttribute("title","Lookup Display Field");t(e).css("width","16px").css("height","16px");h=document.createElement("span");t(h).css("display","inline-block").css("width","200").css("height","auto").css("line-height","normal").css("vertical-align","middle");h.innerHTML=i.FieldValue===""||i.FieldValue===null?i.DisplayName:'<div title="'+i.FieldValue+'" class="sm_availablefield_linkedfield ellide">'+e.outerHTML+"&nbsp;"+i.FieldValue+"<\/div>"+i.DisplayName;s=document.createElement("span");t(s).css("display","inline-block").css("height","auto");t(s).css("padding-left","5px").css("padding-right","15px").css("vertical-align","middle");o=document.createElement("img");o.setAttribute("id","draghandle_"+i.AttributeID);o.setAttribute("src",StaticLibPath+"/icons/Custom/HandleBar.png");o.setAttribute("alt","");o.setAttribute("title","Click here to drag this field");t(o).css("width","19px").css("height","16px");s.appendChild(o);f.appendChild(s);f.appendChild(h);u===undefined||u===!1?c.appendChild(f):t("#availableFields > span").length===0?c.appendChild(f):t("#availableFields > span").each(function(n,r){var u=t(r).text(),o="",e;if(u.substr(u.length-1)==="]")for(u=u.substr(1,u.length-2),e=u.length;e>0;e--)u.substr(e,1)==="["&&(o=u.substr(e+1));if(u=o+u,i.SortDisplayName.toLowerCase()<u.toLowerCase())return t(f).insertBefore(t(r)),!1;n===t("#availableFields > span").length-1&&c.appendChild(f)})},FormModalTabChange:function(i){n.CustomEntityAdministration.Forms.SetDialogTextAndButtonColor();var r=t("#dialog"),u=t("#formdesigntitle");switch(i.get_activeTabIndex()){case 0:t("#imgFormDesignerHelp").css("display","none");r.dialog("close");n.CustomEntityAdministration.Base.RemoveAllShortCuts();break;case 1:t("#imgFormDesignerHelp").css("display","inline-block");r.dialog("open");n.CustomEntityAdministration.Base.AddShortCuts("formDesigner");r.dialog("option","shownState")==="docked"?r.dialog("restore"):r.dialog("collapse");r.parent().css("left",u.offset().left+u.outerWidth()-305);r.parent().css("top",u.offset().top)}},ToggleAvailableFields:function(n){var i=t("#dialog"),r=i.dialog("option","shownState");if(r==="collapsed")switch(n){case"expand":i.dialog("expand");break;case"dock":i.dialog("dock");break;case"dockleft":i.dialog("dock","left");break;case"dockright":i.dialog("dock","right")}else r==="docked"?i.dialog("restore"):i.dialog("collapse")},HideFormModal:function(){n.Common.HideModal(modformid);n.CustomEntityAdministration.Base.RemoveAllShortCuts();t("#dialog").dialog("close");t("#availableFieldDoms").html("");return},SetDialogTextAndButtonColor:function(){var i=t(".ui-dialog-title"),n=i.parent().css("background-color"),r,u,f,e;n.indexOf("rgb")===-1?(n=n.charAt(0)=="#"?n.substring(1,7):n,r=parseInt(n.substring(0,2),16),u=parseInt(n.substring(2,4),16),f=parseInt(n.substring(4,6),16)):(n=n.replace(/[^0-9,]+/g,""),r=n.split(",")[0],u=n.split(",")[1],f=n.split(",")[2]);e=1-(.299*r+.587*u+.114*f)/255;e<.5?(i.css("color","#000000"),t(".ui-dialog-titlebar .ui-icon").removeClass("ui-icon-light").addClass("ui-icon-dark")):(i.css("color","#FFFFFF"),t(".ui-dialog-titlebar .ui-icon").removeClass("ui-icon-dark").addClass("ui-icon-light"))},MoveFieldToNewSection:function(t,i,r){var e=n.CustomEntityAdministration.Forms,u=e.GetSectionByName(i),o=e.GetSectionByName(r),f;if(typeof u!="undefined"&&u!==null)for(f=0;f<u.Fields.length;f++)if(u.Fields[f].AttributeID===t.AttributeID){u.Fields.splice(f,1);e.UpdateSectionInFormObj(u);break}typeof o!="undefined"&&o!==null&&(o.Fields.push(t),e.UpdateSectionInFormObj(o))},ShowSectionModal:function(r,u){var f=n.CustomEntityAdministration.Forms;f.SelectedTab!==null&&(n.CustomEntityAdministration.Base.AssignDummyShortCuts(),u!==undefined&&u===!0&&t("#"+btnSaveSectionid).attr("targetTab",f.SelectedTab),f.ClearSectionModal(),typeof r!="undefined"&&r!==null?(t("#lblSectionModalTitle").html("Section : "+r),i(txtsectionid).value=r):t("#lblSectionModalTitle").html("New Section"),n.Common.ShowModal(modsectionid));i(txtsectionid).select()},ClearSectionModal:function(){validator=i(reqSectionHeaderID);validator.isvalid=!0;c(validator);i(txtsectionid).value=""},HideFieldLabelModal:function(){n.Common.Page_ClientValidateReset();n.Common.HideModal(modfieldid)},ShowFieldLabelModal:function(){n.Common.ShowModal(modfieldid);i(txtfieldlabelID).select()},ClearFieldLabelModal:function(){document.getElementById(txtfieldid).value=""},HideDefaultTextModal:function(){n.Common.HideModal("modDefaultText");t("#defaultTextFieldContainer .active").val("")},ShowDefaultTextModal:function(){n.Common.ShowModal("modDefaultText");t("#defaultTextFieldContainer .active").select()},ShortcutTabEdit:function(){var i=n.CustomEntityAdministration.Forms;i.SelectedTab&&(n.CustomEntityAdministration.Base.AssignDummyShortCuts(),i.EditTabMode=!0,i.EditTabObject=t("#tabbar_"+i.SelectedTab),i.ShowTabModal(i.EditTabObject.length>0?i.EditTabObject.attr("tabname"):null));return},UpdateTabInFormObj:function(t){for(var r=n.CustomEntityAdministration.Forms,i=0;i<r.FormObj.tabs.length;i++)if(r.FormObj.tabs[i].TabControlName===t.TabControlName){r.FormObj.tabs[i]=t;return}return},RemoveTabInFormObj:function(t){for(var r=n.CustomEntityAdministration.Forms,u=!1,i=0;i<r.FormObj.tabs.length;i++)u==!1&&r.FormObj.tabs[i].TabControlName===t&&(r.FormObj.tabs.splice(i,1),u=!0),u&&i<r.FormObj.tabs.length&&(r.FormObj.tabs[i].Order=r.FormObj.tabs[i].Order-1);return},SaveSectionWithModalSave:function(){n.CustomEntityAdministration.Forms.AddSection(document.getElementById(txtSectionHeaderID).value,!0)},AddSectionFromFormButton:function(){n.CustomEntityAdministration.Forms.AddSection(i(txtSectionHeaderID).value,!0)},MoveElementRight:function(n){var i=t("#"+n);i.next().length>0&&i.insertAfter(i.next())},MoveElementLeft:function(n){var i=t("#"+n);i.prev().length>0&&i.insertBefore(i.prev())},CreateOptionsMenu:function(r,u,f){var e=n.CustomEntityAdministration.Forms,o,s,h,c,l,a,v,y,p,w,b,k,d;if(f===null?(o=document.getElementById(popupFormOptionsID),o.className="sm_form_field_options"):(t("#"+u+"_optionsmenu").remove(),o=document.getElementById(popupFieldOptionsID).cloneNode(!0),o.id=u+"_optionsmenu",o.className="sm_form_field_options",t(o).html(""),t(o).css("display","none"),t(o).css("height","26px")),r===e.ControlTypeObject.Section?(s=document.createElement("img"),s.onclick=function(){e.MoveElementLeft(u);t("#"+popupFormOptionsID).css("display","none");return},s.setAttribute("src","../images/icons/16/Plain/arrow_up_blue.png"),s.setAttribute("alt","Move up"),s.setAttribute("title","Move up"),s.className="sm_btn",o.appendChild(s),h=document.createElement("img"),h.onclick=function(){e.MoveElementRight(u);t("#"+popupFormOptionsID).css("display","none");return},h.setAttribute("src","../images/icons/16/Plain/arrow_down_blue.png"),h.setAttribute("alt","Move down"),h.setAttribute("title","Move down"),h.className="sm_btn",o.appendChild(h)):(c=document.createElement("img"),c.onclick=function(){switch(r){case e.ControlTypeObject.Tab:e.MoveElementLeft("tabbar_"+u);e.EditTabObject=null;e.EditTabMode=!1;t("#"+popupFormOptionsID).css("display","none");break;case e.ControlTypeObject.Field:e.MoveElementLeft(u);t("#"+u+"_optionsmenu").css("display","none")}return},c.setAttribute("src","../images/icons/16/Plain/arrow_left_blue.png"),c.setAttribute("alt","Move left"),c.setAttribute("title","Move left"),c.className="sm_btn",o.appendChild(c),l=document.createElement("img"),l.onclick=function(){switch(r){case e.ControlTypeObject.Tab:e.MoveElementRight("tabbar_"+u);e.EditTabObject=null;e.EditTabMode=!1;t("#"+popupFormOptionsID).css("display","none");break;case e.ControlTypeObject.Field:e.MoveElementRight(u);t("#"+u+"_optionsmenu").css("display","none")}return},l.setAttribute("src","../images/icons/16/Plain/arrow_right_blue.png"),l.setAttribute("alt","Move right"),l.setAttribute("title","Move right"),l.className="sm_btn",o.appendChild(l)),r===e.ControlTypeObject.Section?(a=document.createElement("img"),a.onclick=function(){e.EditSectionMode=!0;var n=t("#"+u);e.EditSectionObject=n;e.ShowSectionModal(n.attr("sectionname"));t("#"+popupFormOptionsID).css("display","none");return},a.setAttribute("src","../images/icons/16/Plain/edit.png"),a.setAttribute("alt","Edit section name"),a.setAttribute("title","Edit section name"),a.className="sm_btn",o.appendChild(a)):r===e.ControlTypeObject.Tab?(v=document.createElement("img"),v.onclick=function(){e.EditTabMode=!0;var n=t("#tabbar_"+u);e.EditTabObject=n;e.ShowTabModal(n.attr("tabname"));t("#"+popupFormOptionsID).css("display","none");return},v.setAttribute("src","../images/icons/16/Plain/edit.png"),v.setAttribute("alt","Edit tab name"),v.setAttribute("title","Edit tab name"),v.className="sm_btn",o.appendChild(v)):(f.FieldType===e.FieldTypeEnum.Comment.intVal||f.FieldType===e.FieldTypeEnum.OTMSummary.intVal||f.FieldType===e.FieldTypeEnum.Relationship.intVal&&f.RelationshipType===e.RelationshipType.OneToMany||f.FieldType===e.FieldTypeEnum.Spacer.intVal)==!1&&(y=document.createElement("img"),y.onclick=function(){t("#"+u+"_optionsmenu").css("display","none");e.EditLabelField=f;f.LabelText?t("#"+txtfieldlabelID).val(f.LabelText):t("#"+txtfieldlabelID).val(f.DisplayName);t("#lblFieldLabelModalTitle").html("Field label : "+f.DisplayName);e.ShowFieldLabelModal();return},y.setAttribute("src","../images/icons/16/Plain/edit.png"),y.setAttribute("alt","Edit label text"),y.setAttribute("title","Edit label text"),y.className="sm_btn",o.appendChild(y)),r===e.ControlTypeObject.Tab&&(p=document.createElement("img"),p.onclick=function(){e.ShowSectionModal();t("#"+popupFormOptionsID).css("display","none");return},p.setAttribute("src","../images/icons/16/Plain/row_add_before.png"),p.setAttribute("alt","New section"),p.setAttribute("title","New section"),p.className="sm_btn",o.appendChild(p),e.EditTabObject=t("#"+u)),r===e.ControlTypeObject.Field&&(f.LabelText&&f.LabelText!==f.DisplayName&&(e.EditLabelField=f,w=document.createElement("img"),w.onclick=function(){t("#"+u+"_optionsmenu").css("display","none");e.EditLabelField=f;e.ResetFieldLabel()},w.setAttribute("src",StaticLibPath+"/icons/16/Plain/eraser.png"),w.setAttribute("alt","Remove label text"),w.setAttribute("title","Remove label text"),w.className="sm_btn",o.appendChild(w)),(f.FieldType===e.FieldTypeEnum.Comment.intVal||f.FieldType===e.FieldTypeEnum.OTMSummary.intVal||f.FieldType===e.FieldTypeEnum.Spacer.intVal||f.FieldType===e.FieldTypeEnum.LookupDisplayField.intVal||f.FieldType===e.FieldTypeEnum.Relationship.intVal&&f.RelationshipType===e.RelationshipType.OneToMany)==!1)){if(f.FieldType===e.FieldTypeEnum.Text.intVal||f.FieldType===e.FieldTypeEnum.LargeText.intVal){var tt=t("#txtDefaultText"),g=t("#txtDefaultTextLarge"),nt=t("#"+n.CustomEntityAdministration.DomIDs.Forms.RichTextEditor),rt=$find(n.CustomEntityAdministration.DomIDs.Forms.EditorExtender),it=t("#HtmlEditorContainer");t(".popupDiv").hide();b=document.createElement("img");b.onclick=function(){var o;tt.add(g).hide().removeClass("active");g.add(g).hide().removeClass("active");nt.removeClass("active");it.hide();var u="form_attribute_"+f.AttributeID,n,i="modalpanel formpanel formpanelsmall",r="twocolumn";if(f.Format===e.Format.FormattedText)i="modalpanel formpanel richTextModal",r="sm_field_tall onecolumn richTextField",it.show(),nt.addClass("active"),n=t("#"+u).find(".richTextBox").html(),nt.length>=1&&(rt._editableDiv.innerHTML=n);else if(f.Format===e.Format.MultiLine||f.Format===e.Format.SingleLine&&f.ColumnSpan===2){i="modalpanel formpanel";r="sm_field_tall onecolumn";g.show().addClass("active").off("keyup blur");o=f.MaxLength>0?f.MaxLength:4e3;g.on("keyup blur",function(){var n=t(this).val();n.length>o&&t(this).val(n.slice(0,o))});n=t("#"+u).find("textarea").val()}else f.Format===e.Format.SingleLineWide&&(i="modalpanel formpanel",r="onecolumnsmall"),tt.show().addClass("active").attr("maxlength",f.MaxLength>0?f.MaxLength:500),n=t("#"+u).find("input").val();t("#defaultTextFieldContainer .active").val(n).data("field",f);t("#defaultTextModalTitle").text("Default text : "+f.DisplayName);t("#pnlDefaultText").attr("class",i);t("#defaultTextFieldContainer").attr("class",r);e.ShowDefaultTextModal()};b.setAttribute("src",StaticLibPath+"/icons/16/plain/document_new.png");b.setAttribute("alt","Edit default field value");b.setAttribute("title","Edit default field value");b.className="sm_btn";o.appendChild(b)}k=document.createElement("img");k.onclick=function(){e.selectedControl=i(f.ControlName);e.SetFieldToReadOnly(document.getElementById("lbl_"+f.AttributeID));return};f.FieldType!=e.FieldTypeEnum.Attachment.intVal&&(k.setAttribute("src","../images/icons/16/Plain/text_lock.png"),k.setAttribute("alt","Read only"),k.setAttribute("title","Read only"),k.className="sm_btn",o.appendChild(k))}return d=document.createElement("img"),d.onclick=function(){switch(r){case e.ControlTypeObject.Tab:e.RemoveTab(u);e.EditTabObject=null;e.EditTabMode=!1;t("#"+popupFormOptionsID).css("display","none");break;case e.ControlTypeObject.Section:e.RemoveSection(u);t("#"+popupFormOptionsID).css("display","none");break;case e.ControlTypeObject.Field:e.RemoveFormField(u,f)}return},d.setAttribute("src","../images/icons/16/Plain/delete2.png"),d.setAttribute("alt","Delete"),d.setAttribute("title","Delete"),d.className="sm_btn",o.appendChild(d),o},FormObject:function(){this.formName=null;this.description=null;this.showSave=!1;this.saveButtonText=null;this.showSaveAndDuplicate=!1;this.saveAndDuplicateButtonText=null;this.showSaveAndStay=!1;this.saveAndStayButtonText=null;this.showSaveAndNew=!1;this.saveAndNewButtonText=null;this.showCancel=!1;this.cancelButtonText=null;this.showSubMenus=!1;this.showBreadcrumbs=!1;this.hideTorch=!1;this.hideAudiences=!1;this.hideAttachments=!1;this.tabs=[]},TabObject:function(){this.TabName=null;this.TabControlName=null;this.Sections=[];this.Order=null},SectionObject:function(){this.SectionName=null;this.SectionControlName=null;this.Fields=[];this.Order=null},FieldObject:function(){this.AttributeID=null;this.ControlName=null;this.DisplayName=null;this.Tooltip=null;this.Mandatory=null;this.FieldType=null;this.ReadOnly=null;this.Row=null;this.Column=null;this.Format=null;this.CommentText=null;this.LabelText=null;this.ColumnSpan=null;this.DefaultValue=null;this.MaxLength=null},SpacerField:function(n){n===undefined&&(n=0);var t=new SpendManagementLibrary.sCEFieldDetails;return t.AttributeID=n,t.Column=0,t.ColumnSpan=0,t.CommentText=null,t.ControlName="form_attribute_spacer_"+n,t.Description="",t.DisplayName="Spacer",t.FieldType=20,t.Format=1,t.ColumnSpan=1,t.Row=0,t.Tooltip="",t},SetFieldType:function(t){var r=n.CustomEntityAdministration.Forms,i=null;switch(t){case 1:i=r.FieldTypeEnum.Text;break;case 2:i=r.FieldTypeEnum.Integer;break;case 3:i=r.FieldTypeEnum.DateTime;break;case 4:i=r.FieldTypeEnum.List;break;case 5:i=r.FieldTypeEnum.List;break;case 6:i=r.FieldTypeEnum.Currency;break;case 7:i=r.FieldTypeEnum.Number;break;case 8:i=r.FieldTypeEnum.Hyperlink;break;case 9:i=r.FieldTypeEnum.Relationship;break;case 10:i=r.FieldTypeEnum.LargeText;break;case 11:i=r.FieldTypeEnum.RunWorkflow;break;case 12:i=r.FieldTypeEnum.RelationshipTextBox;break;case 13:i=r.FieldTypeEnum.AutoCompleteTextbox;break;case 15:i=r.FieldTypeEnum.OTMSummary;break;case 16:i=r.FieldTypeEnum.DynamicHyperlink;break;case 17:i=r.FieldTypeEnum.List;break;case 19:i=r.FieldTypeEnum.Comment;break;case 20:i=r.FieldTypeEnum.Spacer;break;case 21:i=r.FieldTypeEnum.LookupDisplayField;break;case 22:i=r.FieldTypeEnum.Attachment;break;case 23:i=r.FieldTypeEnum.Contact}return i},FieldTypeEnum:{None:{intVal:0},Text:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:1},Integer:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:2},DateTime:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:3},List:{idPrefix:"ddl",className:"sm_field twocolumn",fieldTag:"select",columnSpan:1,intVal:4},TickBox:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"checkbox",columnSpan:1,intVal:5},Currency:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:6},Number:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:7},Hyperlink:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:8},Relationship:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:9,attributeName:"One To Many"},LargeText:{idPrefix:"txt",className:"sm_field_tall onecolumn",fieldTag:"textarea",columnSpan:2,intVal:10},RunWorkflow:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:11},RelationshipTextBox:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",columnSpan:1,inputType:"text",intVal:12},AutoCompleteTextbox:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",columnSpan:1,inputType:"text",intVal:13},OTMSummary:{idPrefix:"tbl",className:"sm_field_grid onecolumn",fieldTag:"table",intVal:15,columnSpan:2,attributeName:"Summary"},TextWide:{idPrefix:"txt",className:"sm_field_wide onecolumn",fieldTag:"input",inputType:"text",columnSpan:2,intVal:16},ListWide:{idPrefix:"ddl",className:"sm_field_wide onecolumn",fieldTag:"select",columnSpan:2,intVal:17},Comment:{idPrefix:"pnl",className:"sm_field_comment onecolumn",fieldTag:"span",columnSpan:2,intVal:19},Spacer:{className:"sm_field_spacer",fieldTag:"span",intVal:20},LookupDisplayField:{idPrefix:"ldf",className:"sm_field twocolumn",fieldTag:"span",inputType:"text",columnSpan:1,intVal:21},Attachment:{idPrefix:"fileUpload",className:"sm_field twocolumn",fieldTag:"input",inputType:"button",columnSpan:1,intVal:22},Contact:{idPrefix:"txt",className:"sm_field twocolumn",fieldTag:"input",inputType:"text",columnSpan:1,intVal:23}},Format:{None:0,SingleLine:1,MultiLine:2,DateTime:3,DateOnly:4,TimeOnly:5,FormattedText:6,SingleLineWide:7,ListStandard:8,ListWide:9},RelationshipType:{ManyToOne:1,OneToMany:2}},Views:{Grid:{Refresh:function(t){u(n.CustomEntityAdministration.DomIDs.Views.Grid)===!0&&(i(n.CustomEntityAdministration.DomIDs.Views.Grid).innerHTML=t[1],n.Grid.updateGrid(t[0]));return}},Modal:{Show:function(){n.Common.Page_ClientValidateReset();var o=n.CustomEntityAdministration.DomIDs.Views.Modal,s=n.CustomEntityAdministration.zIndices.Views.Modal,c=n.CustomEntityAdministration.Misc,f,e,u;r(o.TabContainer).set_activeTabIndex(0);n.Common.ShowModal(o.Control);r(o.Control)._backgroundElement.style.zIndex=s-5;r(o.Control)._popupElement.style.zIndex=s;h(i(o.Sort.OrderValidator),!1);f=t("#imgViewFilterHelp");f.css("display","none");f.css("left",f.parent().outerWidth()-38);f.css("top",f.parent().outerHeight()-38);f.mouseenter(function(){u=t("#viewFilterHelpArea");u.css("zIndex",n.CustomEntityAdministration.zIndices.Views.HelpIcon());u.css("left",t(this).offset().left-u.outerWidth());u.css("top",t(this).offset().top-u.outerHeight());u.css("position","absolute");u.stop(!0,!0).fadeIn(400)}).mouseleave(function(){t("#viewFilterHelpArea").stop(!0,!0).fadeOut(200)});e=t("#imgViewColumnHelp");e.css("display","none");e.css("left",e.parent().outerWidth()-38);e.css("top",e.parent().outerHeight()-38);e.mouseenter(function(){u=t("#viewColumnHelpArea");u.css("zIndex",n.CustomEntityAdministration.zIndices.Views.HelpIcon());u.css("left",t(this).offset().left-u.outerWidth());u.css("top",t(this).offset().top-u.outerHeight());u.css("position","absolute");u.stop(!0,!0).fadeIn(400)}).mouseleave(function(){t("#viewColumnHelpArea").stop(!0,!0).fadeOut(200)});c.LoadingScreenCancelled=!0;t("#loadingArea").fadeOut(600,function(){t("#loadingArea").remove()})},Hide:function(){var t=n.CustomEntityAdministration.DomIDs.Views.Modal;r(t.TabContainer).set_activeTabIndex(0);n.Common.HideModal(t.Control)},Clear:function(){var u=n.CustomEntityAdministration.DomIDs.Views.Modal;i(u.General.Name).value="";i(u.General.Description).value="";i(u.General.Menu).selectedIndex=0;i(u.General.MenuDescription).value="";t("#"+u.General.AddForm+" option").prop("disabled",!1);i(u.General.AddForm).selectedIndex=0;t("#"+u.General.AddFormSelectionMappings).data("mappings",[]);t("#"+u.General.EditForm+" option").prop("disabled",!1);i(u.General.EditForm).selectedIndex=0;t("#"+u.General.EditFormSelectionMappings).data("mappings",[]);i(u.General.AllowApproval).checked=!1;i(u.General.AllowDelete).checked=!1;n.CustomEntityAdministration.Views.General.FormSelectionMappings.FormSelectionAttribute=null;n.CustomEntityAdministration.Views.Fields.Tree.Refresh();n.Trees.Tree.Clear(u.Fields.Drop);n.CustomEntityAdministration.Views.Filters.Tree.Refresh();n.Trees.Tree.Clear(u.Filters.Drop);r(u.Sort.Tab).set_enabled(!1);i(u.Sort.Column).selectedIndex=0;i(u.Sort.Direction).selectedIndex=0;t("#"+u.Icon.SearchFileName).val("Search...");t("#viewIconResults").html("");return}},Add:function(){var i=n.CustomEntityAdministration.IDs;if(i.View=0,i.Sort.Column=null,i.Sort.Direction=null,n.CustomEntityAdministration.IDs.Entity===0){currentAction="addView";n.CustomEntityAdministration.Base.Save();return}n.CustomEntityAdministration.Views.Modal.Clear();t("#"+n.CustomEntityAdministration.DomIDs.Views.Modal.PanelHeader).text("New View");Spend_Management.svcCustomEntities.getViewForms(n.CustomEntityAdministration.IDs.Entity,function(t){n.CustomEntityAdministration.Views.General.PopulateForms(t);n.CustomEntityAdministration.Views.General.FormSelectionMappings.GetAttribute();var i=StaticLibPath+"/icons/48/plain/window_dialog.png";n.CustomEntityAdministration.Views.Icon.SetSelectedIcon(i,"window_dialog.png");n.CustomEntityAdministration.Views.Icon.SearchFileName("",0);n.CustomEntityAdministration.Views.Modal.Show()},n.CustomEntityAdministration.Misc.ErrorHandler)},Edit:function(r){var e=n.CustomEntityAdministration,f=e.IDs,c=e.DomIDs,o=e.Views,u=c.Views.Modal,h=e.Misc;h.LoadingScreenCancelled=!1;setTimeout(function(){h.ShowInformationMessage("Loading...")},300);f.View=r;o.Modal.Clear();Spend_Management.svcCustomEntities.getView(s.AccountID,f.Entity,f.View,function(r){var e,s,h,c;if(t("#"+u.PanelHeader).text("View: "+r.viewName),i(u.General.Name).value=r.viewName,i(u.General.Description).value=r.description,o.General.PopulateForms(r.formDropDownOptions),o.General.FormSelectionMappings.GetAttribute(),s=i(u.General.Menu),r.nMenuid===null)s.selectedIndex=0;else for(e=0;e<s.options.length;e=e+1)if(s.options[e].value===r.nMenuid.toString()){s.selectedIndex=e;break}for(i(u.General.MenuDescription).value=r.MenuDescription,h=i(u.General.AddForm),e=0;e<h.options.length;e=e+1)if(h.options[e].value===r.addFormID.toString()){h.selectedIndex=e;break}for(r.addFormID>0&&r.AddFormMappings!==null&&t("#"+u.General.AddFormSelectionMappings).data("mappings",r.AddFormMappings),c=i(u.General.EditForm),e=0;e<c.options.length;e=e+1)if(c.options[e].value===r.editFormID.toString()){c.selectedIndex=e;break}r.editFormID>0&&r.EditFormMappings!==null&&t("#"+u.General.EditFormSelectionMappings).data("mappings",r.EditFormMappings);i(u.General.AllowDelete).checked=r.allowDelete;i(u.General.AllowApproval).checked=r.allowApproval;f.Sort.Column=r.SortedColumnID;f.Sort.Direction=r.SortOrderDirection;t("#"+u.General.Name).select();o.Fields.Drop.Refresh();n.CustomEntityAdministration.Views.Icon.SetSelectedIcon(r.MenuIcon.IconUrl,r.MenuIcon.IconName);n.CustomEntityAdministration.Views.Icon.SearchFileName("",0)},n.CustomEntityAdministration.Misc.ErrorHandler);return},SaveWithModalCheck:function(){n.CustomEntityAdministration.Misc.LoadingScreenCancelled&&n.CustomEntityAdministration.Views.Save()},Save:function(){var l=n.CustomEntityAdministration.Misc,w;if(l.LoadingScreenCancelled=!1,n.CustomEntityAdministration.Views.Sort.Refresh(),validateform("vgView")!==!1){setTimeout(function(){l.ShowInformationMessage("Saving...")},450);var u=n.CustomEntityAdministration,r=u.DomIDs.Views.Modal,f=u.IDs,nt=i(r.General.Name).value,tt=i(r.General.Description).value,it=i(r.General.Menu).options[i(r.General.Menu).selectedIndex].value,rt=i(r.General.MenuDescription).value,a=i(r.General.AddForm),v=i(r.General.EditForm),b=0,k=0,ut=i(r.General.AllowDelete).checked,ft=i(r.General.AllowApproval).checked,et=n.Trees.Tree.Data.Get(r.Fields.Drop),ot=n.Trees.Tree.Data.Get(r.Filters.Drop,["metadata"]),y=i(r.Sort.Column),d=i(r.Sort.Direction),e={SortID:"00000000-0000-0000-0000-000000000000_0",FieldID:"00000000-0000-0000-0000-000000000000",JoinViaID:0,JoinViaPath:"",JoinViaCrumbs:""},g="0",p,o,h,c;a.selectedIndex>0&&(b=a.options[a.selectedIndex].value);v.selectedIndex>0&&(k=v.options[v.selectedIndex].value);y.selectedIndex!==-1&&(p=y.options[y.selectedIndex],o=t(p),e.SortID=p.value,e.FieldID=o.attr("FieldID"),e.JoinViaID=o.attr("JoinViaID"),e.JoinViaPath=o.attr("JoinViaPath"),e.JoinViaCrumbs=o.attr("JoinViaCrumbs"),g=d.options[d.selectedIndex].value);w=null;t("#selectedIconSpan .selectedIcon").length===1&&(w=t("#selectedIconSpan .selectedIcon").data("iconName"));h=t("#"+r.General.AddFormSelectionMappings).data("mappings");h=h===null?[]:h;c=t("#"+r.General.EditFormSelectionMappings).data("mappings");c=c===null?[]:c;Spend_Management.svcCustomEntities.SaveView(s.AccountID,s.EmployeeID,f.Entity,f.View,nt,tt,it,rt,et,b,k,ut,ft,ot,e,g,w,h,c,function(i){if(i===-1){l.LoadingScreenCancelled=!0;t("#loadingArea").remove();n.MasterPopup.ShowMasterPopup(u.Messages.Views.DuplicateName);return}u.Views.Modal.Hide();l.LoadingScreenCancelled=!0;t("#loadingArea").fadeOut(600,function(){t("#loadingArea").remove()});Spend_Management.svcCustomEntities.getViewGrid(f.Entity,u.Views.Grid.Refresh,n.CustomEntityAdministration.Misc.ErrorHandler);Spend_Management.svcCustomEntities.getPopupViews(f.Entity,f.View,s.AccountID,u.Base.RefreshPopupViewDDL,n.CustomEntityAdministration.Misc.ErrorHandler);u.Views.General.FormSelectionMappings.RefreshFormSelectionAttribute(f.Entity)},n.CustomEntityAdministration.Misc.ErrorHandler);return}},Delete:function(t,i,r){confirm(n.CustomEntityAdministration.Messages.Views.DeleteSure)&&Spend_Management.svcCustomEntities.checkViewDoesNotBelongToPopupView(t,i,function(u){u===0?Spend_Management.svcCustomEntities.DeleteView(t,function(u){u===0?(Spend_Management.svcCustomEntities.getViewGrid(n.CustomEntityAdministration.IDs.Entity,n.CustomEntityAdministration.Views.Grid.Refresh,n.CustomEntityAdministration.Misc.ErrorHandler),Spend_Management.svcCustomEntities.getPopupViews(r,t,i,n.CustomEntityAdministration.Base.RefreshPopupViewDDL,n.CustomEntityAdministration.Misc.ErrorHandler),n.CustomEntityAdministration.Views.General.FormSelectionMappings.RefreshFormSelectionAttribute(r)):n.MasterPopup.ShowMasterPopup(n.CustomEntityAdministration.Messages.Views.DeleteAbortInUse)},n.CustomEntityAdministration.Misc.ErrorHandler):n.MasterPopup.ShowMasterPopup(n.CustomEntityAdministration.Messages.Views.DeleteAbortPopupViewInUse)})},General:{PopulateForms:function(r){var u,s=n.CustomEntityAdministration.DomIDs.Views.Modal,h=i(s.General.AddForm),c=i(s.General.EditForm),l=t("select.mapping-forms"),f,e,a="",o;for(h.options.length=0,c.options.length=0,l.empty(),o={},u=0;u<r.length;u=u+1)f=document.createElement("option"),f.value=r[u].Value,f.text=r[u].Text,e=document.createElement("option"),e.value=r[u].Value,e.text=r[u].Text,r[u].Value!=="0"&&r[u].Value!==0&&(a+='<option value="'+r[u].Value+'">'+r[u].Text+"<\/option>"),o[r[u].Value]=r[u].Text,h.add(f),c.add(e);l.append(a);this.FormSelectionMappings.Forms=o;return},FormSelectionMappings:{IsAdd:null,Forms:null,FormSelectionAttribute:null,FormSelectionAttributeListItems:null,RefreshFormSelectionAttribute:function(i){n.Data.Ajax({serviceName:"svcCustomEntities",methodName:"HasFormSelectionMappings",data:{entityId:i},success:function(i){"d"in i&&t("#"+n.CustomEntityAdministration.DomIDs.Base.FormSelectionAttribute).prop("disabled",i.d)}})},Show:function(i){var e=n.CustomEntityAdministration,f=e.DomIDs.Views.Modal.General,u=e.Views.General.FormSelectionMappings,o;if(this.FormSelectionAttribute===null){n.MasterPopup.ShowMasterPopup("A Form selection attribute must be defined before any form selection mappings can be created.<br />You can define a Form selection attribute on the Greenlight Details page.");return}if(t(i).data("isadd")&&(t("#"+f.AddForm).val()===0||t("#"+f.AddForm).val()==="0")){n.MasterPopup.ShowMasterPopup("A Default add form must be selected before form selection mappings can be created.");return}if(t(i).data("isadd")===!1&&(t("#"+f.EditForm).val()===0||t("#"+f.EditForm).val()==="0")){n.MasterPopup.ShowMasterPopup("A Default edit form must be selected before form selection mappings can be created.");return}u.Clear();u.IsAdd=t(i).data("isadd");u.SetTitle(u.IsAdd?"New Add Form Selection":"New Edit Form Selection");o=u.GetMappings(i);u.AddRows(o);this.FormSelectionAttribute.attributeType==="list"?(t(".mapping-listrow").show(),t(".mapping-textrow").hide()):(t(".mapping-listrow").hide(),t(".mapping-textrow").show());r(e.DomIDs.Views.Modal.General.FormSelectionMappings.Modal).show();return},Save:function(){var t=n.CustomEntityAdministration,i=t.Views.General.FormSelectionMappings,u=i.GetRows();i.SetMappings(u);r(t.DomIDs.Views.Modal.General.FormSelectionMappings.Modal).hide()},Cancel:function(){var t=n.CustomEntityAdministration;r(t.DomIDs.Views.Modal.General.FormSelectionMappings.Modal).hide()},Clear:function(){var r=n.CustomEntityAdministration,i=r.DomIDs.Views.Modal.General.FormSelectionMappings;t("#"+i.Panel+" .mapping-title").empty();t("#"+i.Panel+" .mapping-text").val("");t("#"+i.Panel+" .mapping-list option").prop({disabled:!1,selected:!1});t("#"+i.Panel+" .mapping-list option:eq(0), #"+i.Panel+" .mapping-forms option:eq(0)").prop("selected",!0);t("#"+i.Panel+" .mapping-tbody").empty();t("#"+i.Panel+" .mapping-empty").show()},SetTitle:function(i){t("#"+n.CustomEntityAdministration.DomIDs.Views.Modal.General.FormSelectionMappings.Header).text(i)},New:function(i){var r=n.CustomEntityAdministration.Views.General.FormSelectionMappings,u=t(".mapping-list").val(),f=t(i).closest("tr").find(".mapping-forms"),o=r.FormatRow(0,r.FormSelectionAttribute.attributeType==="list",u,t(".mapping-text").val(),f.val()),e;if(r.FormSelectionAttribute.attributeType==="text"){if(e=!1,t(".mapping-tbody tr").each(function(n,i){if(i=t(i).children("td:first").children("span"),t(".mapping-text").val().toLowerCase()===t(i).html().toLowerCase()){e=!0;return}}),e){n.MasterPopup.ShowMasterPopup("The Form Selection Attribute Value could not be added because it is not unique.");return}t(".mapping-text").val("")}t(".mapping-list option:selected").prop("disabled")||(t(".mapping-tbody").append(o),!isNaN(parseInt(u,10))&&parseInt(u,10)>0&&(t(".mapping-list option[value="+u+"]").prop("disabled",!0),t(".mapping-list option:enabled:first").prop("selected",!0)),f.val(f.children("option:first").val()),r.RefreshMappingRows())},RefreshMappingRows:function(){t(".mapping-tbody tr").length>0?(t(".mapping-empty").hide(),t(".mapping-tbody tr:even td").addClass("row1"),t(".mapping-tbody tr:odd td").addClass("row2")):t(".mapping-empty").show()},GetAttribute:function(){var i=n.CustomEntityAdministration,r=i.Views.General.FormSelectionMappings,u=t("#"+i.DomIDs.Base.FormSelectionAttribute).val(),e="",f=0;!isNaN(parseInt(u))&&parseInt(u,10)>0&&n.Data.Ajax({data:{entityId:i.IDs.Entity,attributeId:parseInt(u,10)},serviceName:"svcCustomEntities",methodName:"GetFormSelectionAttribute",success:function(n){"d"in n&&(r.FormSelectionAttribute=n.d,n.d.attributeType==="list"?(t(".mapping-list").empty(),r.FormSelectionAttributeListItems={},t(n.d.items).each(function(n,t){f=parseInt(t.Value,10);isNaN(f)||(r.FormSelectionAttributeListItems[f]=t.Text);e+='<option value= "'+t.Value+'">'+t.Text+"<\/option>"}),t(".mapping-list").append(e)):t(".mapping-text").attr("maxlength",n.d.maxLength||500))}})},GetMappings:function(n){if(typeof n!="object")return[];var i=t(n).data("mappings");return i===null?[]:i},SetMappings:function(i){i===null&&(i=[]);var u=n.CustomEntityAdministration,r=u.DomIDs.Views.Modal.General;u.Views.General.FormSelectionMappings.IsAdd?(t("#"+r.AddFormSelectionMappings).data("mappings",i),i.length>0?t("#"+r.AddForm+" option[value=0]").prop("disabled",!0):t("#"+r.AddForm+" option[value=0]").prop("disabled",!1)):(t("#"+r.EditFormSelectionMappings).data("mappings",i),i.length>0?t("#"+r.EditForm+" option[value=0]").prop("disabled",!0):t("#"+r.EditForm+" option[value=0]").prop("disabled",!1))},AddRows:function(i){if("length"in i&&i.length>0){var r=n.CustomEntityAdministration.Views.General.FormSelectionMappings,u="",f=r.FormatRow;t(i).each(function(n,i){u+=f(i.FormSelectionMappingId,i.TextValue===null,i.ListValue,i.TextValue,i.FormId);!isNaN(parseInt(i.ListValue,10))&&parseInt(i.ListValue,10)>0&&t(".mapping-list option[value="+i.ListValue+"]").prop("disabled",!0)});t(".mapping-tbody").append(u);r.RefreshMappingRows()}},FormatRow:function(t,i,r,u,f){var e=n.CustomEntityAdministration.Views.General.FormSelectionMappings,s=e.FormSelectionAttributeListItems,o=e.EncodeValueText,h=e.Forms;return'<tr data-mappingid="'+t+'"><td>'+(i?'<span class="mapping-listvalue">'+r+"<\/span>"+o(s[r]):'<span class="mapping-textvalue">'+o(u))+'<\/span><\/td><td><span class="mapping-formid">'+f+"<\/span>"+o(h[f])+'<\/td><td class="cgridnew-icon"><img class="btn mapping-deletebutton" src="/static/icons/16/plain/delete.png" alt="delete form mapping" onclick="SEL.CustomEntityAdministration.Views.General.FormSelectionMappings.Delete(this);" /><\/td><\/tr>'},GetRows:function(){var f=n.CustomEntityAdministration,i=f.Views.General.FormSelectionMappings,e=[],r,u;return t(".mapping-tbody tr").each(function(n,o){(o=t(o),isNaN(parseInt(o.find(".mapping-formid").text(),10)))||(i.FormSelectionAttribute.attributeType==="text"?(r=-1,u=i.DecodeValueText(o.find(".mapping-textvalue").text())):(r=isNaN(parseInt(o.find(".mapping-listvalue").text(),10))?0:parseInt(o.find(".mapping-listvalue").text(),10),u=null),e.push({FormSelectionMappingId:o.data("mappingid"),ViewId:f.IDs.View,IsAdd:i.IsAdd,FormId:parseInt(o.find(".mapping-formid").text(),10),ListValue:r,TextValue:u}))}),e},Delete:function(i){var r,u=t(i).closest("tr").find(".mapping-listvalue");u!==null&&u.length>0&&(r=parseInt(u.text(),10),!isNaN(r)&&r>0&&t(".mapping-list option[value="+r+"]").prop("disabled",!1));t(i).closest("tr").remove();n.CustomEntityAdministration.Views.General.FormSelectionMappings.RefreshMappingRows()},EncodeValueText:function(n){return typeof n=="string"?n.replace("&","&#38;").replace("<","&#60;"):n},DecodeValueText:function(n){return typeof n=="string"?n.replace("&#60;","<").replace("&#38;","&"):n}}},Tabs:{TabChange:function(i){t("#imgViewFilterHelp").css("display","none");t("#imgViewColumnHelp").css("display","none");t("#filtermetadata").css("display","none");switch(i.get_activeTabIndex()){case 1:t("#imgViewColumnHelp").css("display","inline-block");break;case 2:t("#imgViewFilterHelp").css("display","inline-block");t("#filtermetadata").css("display","");break;case 3:n.CustomEntityAdministration.Views.Icon.SetupIconSearch();break;case 4:n.CustomEntityAdministration.Views.Sort.Refresh()}}},Fields:{Tree:{Refresh:function(){Spend_Management.svcCustomEntities.GetInitialTreeNodes(n.CustomEntityAdministration.IDs.Entity,function(t){var i=n.CustomEntityAdministration.DomIDs.Views.Modal.Fields.Tree;n.Trees.Tree.Clear(i);t!==null&&n.Trees.Tree.Data.Set(i,t)},n.CustomEntityAdministration.Misc.ErrorHandler)}},Drop:{Refresh:function(){var i=n.CustomEntityAdministration.IDs,t=n.CustomEntityAdministration.DomIDs.Views.Modal.Fields;Spend_Management.svcCustomEntities.GetSelectedNodes(i.Entity,i.View,function(i){n.Trees.Tree.Clear(t.Drop);i!==null&&n.Trees.Tree.Data.Set(t.Drop,i);n.Trees.Node.Disable(t.Tree,null,"refresh");n.CustomEntityAdministration.Views.Sort.Tab.Refresh();n.CustomEntityAdministration.Views.Filters.Drop.Refresh()},n.CustomEntityAdministration.Misc.ErrorHandler)}}},Filters:{Tree:{Refresh:function(){Spend_Management.svcCustomEntities.GetInitialTreeNodes(n.CustomEntityAdministration.IDs.Entity,function(t){var i=n.CustomEntityAdministration.DomIDs.Views.Modal.Filters.Tree;n.Trees.Tree.Clear(i);t!==null&&n.Trees.Tree.Data.Set(i,t)},n.CustomEntityAdministration.Misc.ErrorHandler)}},Drop:{Refresh:function(){Spend_Management.svcCustomEntities.GetSelectedFilterNodes(n.CustomEntityAdministration.IDs.Entity,n.CustomEntityAdministration.IDs.View,function(i){var r=n.CustomEntityAdministration.DomIDs.Views.Modal.Filters.Drop;n.Trees.Tree.Clear(r);i!==null&&n.Trees.Tree.Data.Set(r,i);n.CustomEntityAdministration.Views.Modal.Show();n.CustomEntityAdministration.Misc.LoadingScreenCancelled=!0;t("#loadingArea").fadeOut(600,function(){t("#loadingArea").remove()})},n.CustomEntityAdministration.Misc.ErrorHandler)}}},Sort:{Tab:{Refresh:function(){var t=n.CustomEntityAdministration.DomIDs.Views.Modal,i=n.CustomEntityAdministration.IDs.Sort;n.Trees.Tree.NodeCount(t.Fields.Drop)>0?r(t.Sort.Tab).set_enabled(!0):(r(t.Sort.Tab).set_enabled(!1),i.Column=null,i.Direction=null)}},Refresh:function(){var o=n.CustomEntityAdministration.Views.Sort,f=n.CustomEntityAdministration.DomIDs.Views.Modal,h=n.Trees.Tree.Data.Get(f.Fields.Drop),e=n.CustomEntityAdministration.IDs.Sort.Column,s=n.CustomEntityAdministration.IDs.Sort.Direction,u=i(f.Sort.Column),r=document.createElement("option"),c=n.CustomEntityAdministration.Messages;u.options.length=0;r.value="00000000-0000-0000-0000-000000000000_0";r.text=c.NoneOption;u.options[0]=r;t(h.data).each(function(n,i){r=document.createElement("option");r.text=typeof i.data=="object"?i.attr.crumbs===undefined?i.data.title:i.data.title+" ["+i.attr.crumbs+"]":i.attr.crumbs===undefined?i.data:i.data+" ["+i.attr.crumbs+"]";r.value=i.attr.joinviaid>0?i.attr.fieldID+"_"+i.attr.joinviaid:r.value=i.attr.id+"_"+i.attr.joinviaid;t(r).attr({FieldID:i.attr.fieldID,JoinViaID:i.attr.joinviaid,JoinViaPath:i.attr.id,JoinViaCrumbs:i.attr.crumbs===undefined?"":i.attr.crumbs});try{u.add(r,u.options[null])}catch(f){u.add(r,null)}});e!==null&&t("#"+f.Sort.Column+" option[value="+e+"]").length>0&&t("#"+f.Sort.Column).val(e);s!==null&&u.selectedIndex>0&&t("#"+f.Sort.Direction).val(s);o.ChangeColumnSortOrderState();o.Tab.Refresh()},ChangeColumnSortOrderState:function(){var o=n.CustomEntityAdministration.DomIDs.Views.Modal,u=i(o.Sort.Column),f=i(o.Sort.Direction),r=t(f).parent().prevAll("label"),e=i(o.Sort.OrderValidator);n.CustomEntityAdministration.IDs.Sort.Column=u.selectedIndex>0?u.options[u.selectedIndex].value:null;u.selectedIndex>0?(f.disabled=!1,r.addClass("mandatory"),r.text(r.text().replace("*","")+"*"),h(e,!0)):(f.selectedIndex=0,f.disabled=!0,r.removeClass("mandatory"),r.text(r.text().replace("*","")),h(e,!1));e.isvalid=!0;c(e)},ChangeDirectionState:function(){n.CustomEntityAdministration.IDs.Sort.Direction=f(n.CustomEntityAdministration.DomIDs.Views.Modal.Sort.Direction)}},Icon:{SetupIconSearch:function(){var u=n.CustomEntityAdministration.Views.Icon,i=t("#"+n.CustomEntityAdministration.DomIDs.Views.Modal.Icon.SearchFileName),f=t("#iconSearchButton"),r=t("#iconSearchRemoveButton");r.unbind("click").click(function(){i.val("Search...");u.SearchFileName("",0);r.stop(!0,!0).fadeOut(200)});f.unbind("click").click(function(){i.val()!=="Search..."&&i.val()!==""&&u.SearchFileName(i.val(),0)});i.unbind("click").click(function(){i.val()==="Search..."&&i.val("")});i.unbind("keypress.iconSearch").bind("keypress.iconSearch",function(n){n.which==13&&(n.preventDefault(),u.SearchFileName(i.val(),0),t.trim(i.val())===""?r.stop(!0,!0).fadeOut(200):r.stop(!0,!0).fadeIn(200))});i.unbind("blur").blur(function(){t.trim(i.val())===""?(i.val("Search..."),r.stop(!0,!0).fadeOut(200)):r.stop(!0,!0).fadeIn(200)});t("#iconResultsLeft, #iconResultsRight").disableSelection().unbind("click").click(function(){t(this).hasClass("active")&&t(this).data("fileName")!==undefined&&t(this).data("startFrom")!==undefined&&u.SearchFileName(t(this).data("fileName"),t(this).data("startFrom"))});t("#iconResultsLeft, #iconResultsRight").unbind("hover").hover(function(){t(this).hasClass("active")&&t(this).stop(!0,!1).animate({"font-size":"38pt"},200).data("large",!0)},function(){t(this).hasClass("active")?t(this).stop(!0,!1).animate({"font-size":"28pt"},200).data("large",!1):t(this).stop(!0,!1).animate({"font-size":"20pt"},200).data("large",!1)})},SearchFileName:function(i,r){t.ajax({type:"POST",url:window.appPath+"/shared/webServices/svcCustomEntities.asmx/SearchStaticIconsByFileName",dataType:"json",contentType:"application/json; charset=utf-8",data:'{ "fileName":"'+i.replace(/\\/g,"").replace(/\"/g,"")+'", "searchStartNumber":"'+r+'" }',success:function(u){var c=n.CustomEntityAdministration.Views.Icon,l=t("#viewIconResults"),e=t(document.createElement("span")).css("display","none"),h,o,a,f,s;for(l.fadeOut(200),c.Refresh(i,u.d.FurtherResults,r,u.d.ResultEndNumber),u.d.MenuIcons.length<11?e.css("margin-top","90px"):u.d.MenuIcons.length<21?e.css("margin-top","55px"):e.css("margin-top","15px"),h=u.d.MenuIcons,o=0,a=h.length;o<a;o++)f=document.createElement("img"),f.setAttribute("src",h[o].IconUrl),f.setAttribute("class","viewPreviewIcon"),f.setAttribute("className","viewPreviewIcon"),t(f).data("iconName",h[o].IconName),s=document.createElement("span"),s.setAttribute("class","iconContainer"),s.setAttribute("className","iconContainer"),s.appendChild(f),e.append(s);l.promise().done(function(){t("#viewIconResults").remove();e.attr("id","viewIconResults").appendTo(t("#viewCustomIconContainer")).fadeIn(200,function(){c.SetupPreviewIcons()})})},error:function(t,i,r){n.Common.WebService.ErrorHandler(r)}})},SetupPreviewIcons:function(){var n=t("#viewIconResults .viewPreviewIcon");n.unbind("hover").hover(function(){t(this).stop(!0,!0).animate({"margin-top":"-8px","margin-left":"-8px",height:"64px",width:"64px"},200)},function(){t(this).stop(!0,!1).animate({"margin-top":"0px","margin-left":"0px",height:"48px",width:"48px"},200)});n.unbind("click").click(function(){var f=t("#selectedIconSpan"),n=t("#selectedIconSpan .selectedIcon"),u,i,r;n.length===1&&(u=t(this).data("iconName"),i=t("#selectedIconName"),i.stop(!0,!0).fadeOut(150,function(){i.html(u);i.fadeIn(150)}),r=t("<img><\/img>").attr("src",t(this).attr("src")).addClass("selectedIcon"),r.css("display","none").data("iconName",u),n.css("position","absolute"),f.append(r),n.fadeOut(500,function(){n.remove()}),r.fadeIn(500))})},Refresh:function(n,i,r,u){var f=t("#iconResultsRight"),e=t("#iconResultsLeft");i?f.data("large")!==!0&&f.addClass("active").stop(!0,!1).animate({"font-size":"28pt"},200):f.removeClass("active").stop(!0,!1).animate({"font-size":"20pt"},200);u>30?e.data("large")!==!0&&e.addClass("active").stop(!0,!1).animate({"font-size":"28pt"},200):t("#iconResultsLeft").removeClass("active").stop(!0,!1).animate({"font-size":"20pt"},200);f.data("startFrom",u);e.data("startFrom",r-30);t("#iconResultsRight, #iconResultsLeft").data("fileName",n)},SetSelectedIcon:function(n,i){var r=t("<img><\/img").attr("src",n).addClass("selectedIcon");r.data("iconName",i);t("#selectedIconSpan").html("").append(r);t("#selectedIconName").html(i)}}}}}window.Sys&&window.Sys.loader?window.Sys.loader.registerScript("CustomEntityAdministration",null,a):a()})(SEL,jQuery,$g,$f,$e,$ddlValue,$ddlText,$ddlSetSelected,CurrentUserInfo,ValidatorEnable,ValidatorUpdateDisplay,moduleNameHTML);
//# sourceMappingURL=sel.customEntityAdministration.min.js.map
